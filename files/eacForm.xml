<form xmlns:xf="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events">
    <h1>
        <xf:output value="eac:cpfDescription/eac:identity/eac:nameEntry[@preferredForm = 'true'][1]/eac:part[@localType='full']"/>
        <small>
            <xf:output value="if(eac:control/eac:recordId[.!=''], concat(' | ', normalize-space(eac:control/eac:recordId)), '')"/>
        </small>
    </h1>
    <xf:case id="controlPanel" selected="false">
        <xf:group ref="eac:control">
            <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-control']/tei:div[@type='fullName']"/>
            <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-control']/tei:div[@type='summary']"/></xf:hint>
            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-control']/tei:div[@type='description']"/></xf:help>
            <xf:group ref=".">
                <xf:select1 ref="@maintenanceStatus">
                    <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-maintenanceStatus']/tei:div[@type='fullName']"  class="{if(is-valid(.), 'valid', 'invalid')}"/>
                    <xf:item>
                        <xf:label>cancelled</xf:label>
                        <xf:value>cancelled</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>deleted</xf:label>
                        <xf:value>deleted</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>deletedMerged</xf:label>
                        <xf:value>deletedMerged</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>deletedReplaced</xf:label>
                        <xf:value>deletedReplaced</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>deletedSplit</xf:label>
                        <xf:value>deletedSplit</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>derived</xf:label>
                        <xf:value>derived</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>new</xf:label>
                        <xf:value>new</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>revised</xf:label>
                        <xf:value>revised</xf:value>
                    </xf:item>
                    <!--<xf:hint><xf:output value="normalize-space(instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-maintenanceStatus']/tei:div[@type='summary'])"/></xf:hint>-->
                    <xf:help><xf:output value="normalize-space(instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-maintenanceStatus']/tei:div[@type='description'])"/></xf:help>
                </xf:select1>
                <xf:input ref="eac:recordId">
                    <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-recordId']/tei:div[@type='fullName']"/>
                    <xf:hint><xf:output value="normalize-space(instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-recordId']/tei:div[@type='summary'])"/></xf:hint>
                    <xf:help><xf:output value="normalize-space(instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-recordId']/tei:div[@type='description'])"/></xf:help>
                    <xf:alert><xf:output value="normalize-space(instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-recordId']/tei:div[@type='availability'])"/></xf:alert>
                </xf:input>
            </xf:group>
            <xf:group ref="eac:maintenanceAgency">
                <!--@todo control validation-->
                <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceAgency']/tei:div[@type='fullName']"  class="{if(is-valid(.), 'valid', 'invalid')}"/>
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceAgency']/tei:div[@type='description']"/></xf:help>
                <xf:alert><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceAgency']/tei:div[@type='availability']"/></xf:alert>
                <xf:group class="trigger">
                    <xf:trigger>
                        <xf:label><xf:output value="concat('+ ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyCode']/tei:div[@type='fullName'])"/></xf:label>
                        <xf:insert if="eac:agencyCode" context="." nodeset="eac:agencyCode" origin="instance('eacMaintenanceAgency')/eac:agencyCode" at="last()" ev:event="DOMActivate"/>
                        <xf:insert if="not(eac:agencyCode)" context="." nodeset="*" origin="instance('eacMaintenanceAgency')/eac:agencyCode" at="1" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger>
                        <xf:label><xf:output value="concat('+ ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyName']/tei:div[@type='fullName'])"/></xf:label>
                        <xf:insert if="eac:agencyName" context="." nodeset="eac:agencyName" origin="instance('eacMaintenanceAgency')/eac:agencyName" at="last()" ev:event="DOMActivate"/>
                        <xf:insert if="eac:agencyCode and not(eac:agencyName)" context="." nodeset="eac:agencyCode" origin="instance('eacMaintenanceAgency')/eac:agencyName" at="last()" ev:event="DOMActivate"/>
                        <xf:insert if="not(eac:agencyCode) and not(eac:agencyName)" context="." nodeset="*" origin="instance('eacMaintenanceAgency')/eac:agencyName" at="1" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger ref=".[eac:agencyCode]">
                        <xf:label><xf:output value="concat('+ ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-otherAgencyCode']/tei:div[@type='fullName'])"/></xf:label>
                        <xf:insert if="eac:otherAgencyCode" context="." nodeset="eac:otherAgencyCode" origin="instance('eacMaintenanceAgency')/eac:otherAgencyCode" at="last()" ev:event="DOMActivate"/>
                        <xf:insert if="eac:agencyName and not(eac:otherAgencyCode)" context="." nodeset="eac:agencyName" origin="instance('eacMaintenanceAgency')/eac:otherAgencyCode" at="last()" ev:event="DOMActivate"/>
                        <xf:insert if="not(eac:agencyName) and not(eac:otherAgencyCode)" context="." nodeset="eac:agencyCode" origin="instance('eacMaintenanceAgency')/eac:otherAgencyCode" at="last()" ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:group>
                <xf:repeat nodeset="eac:agencyCode">
                    <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyCode']/tei:div[@type='fullName']"/>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyCode']/tei:div[@type='description']"/></xf:help>
                    <xf:input ref=".">
                        <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyCode']/tei:div[@type='summary']"/></xf:hint>
                        <xf:alert><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyCode']/tei:div[@type='availability']"/></xf:alert>
                    </xf:input>
                    <xf:group class="trigger">
                        <xf:trigger ref="self::eac:agencyCode[parent::eac:maintenanceAgency[not(eac:otherAgencyCode)] or count(parent::eac:maintenanceAgency[eac:otherAgencyCode]/eac:agencyCode) > 1]">
                            <xf:label><xf:output value="concat('- ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyCode']/tei:div[@type='fullName'])"/></xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:group>
                </xf:repeat>
                <xf:repeat nodeset="eac:agencyName">
                    <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyName']/tei:div[@type='fullName']"/>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyName']/tei:div[@type='description']"/></xf:help>
                    <xf:input ref=".">
                        <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyName']/tei:div[@type='summary']"/></xf:hint>
                        <xf:alert><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyName']/tei:div[@type='availability']"/></xf:alert>
                    </xf:input>
                    <xf:group class="trigger">
                        <xf:trigger>
                            <xf:label><xf:output value="concat('- ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agencyName']/tei:div[@type='fullName'])"/></xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:group>
                </xf:repeat>
                <xf:repeat nodeset="eac:otherAgencyCode">
                    <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-otherAgencyCode']/tei:div[@type='fullName']"/>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-otherAgencyCode']/tei:div[@type='description']"/></xf:help>
                    <xf:input ref=".">
                        <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-otherAgencyCode']/tei:div[@type='summary']"/></xf:hint>
                        <xf:alert><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-otherAgencyCode']/tei:div[@type='availability']"/></xf:alert>
                    </xf:input>
                    <xf:group class="trigger">
                        <xf:trigger>
                            <xf:label><xf:output value="concat('- ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-otherAgencyCode']/tei:div[@type='fullName'])"/></xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:group>
                </xf:repeat>
            </xf:group>
            <xf:group ref="eac:maintenanceHistory">
                <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceHistory']/tei:div[@type='fullName']"/>
                <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceHistory']/tei:div[@type='summary']"/></xf:hint>
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceHistory']/tei:div[@type='description']"/></xf:help>
                <xf:group class="trigger">
                    <xf:trigger>
                        <xf:label><xf:output value="concat('+ ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceEvent']/tei:div[@type='fullName'])"/></xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert context="." nodeset="eac:maintenanceEvent" at="1" position="before" origin="instance('eacMaintenanceEvent')/eac:maintenanceEvent"/>
                        </xf:action>
                        <!--<xf:delete nodeset="eac:maintenanceEvent[last()]/eac:eventDescription" ev:event="DOMActivate"/>-->
                    </xf:trigger>
                </xf:group>
                <xf:repeat nodeset="eac:maintenanceEvent">
                    <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceEvent']/tei:div[@type='fullName']"/>
                    <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceEvent']/tei:div[@type='summary']"/></xf:hint>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceEvent']/tei:div[@type='description']"/></xf:help>
                    <xf:group class="trigger">
                        <xf:trigger ref="self::eac:maintenanceEvent[count(parent::eac:maintenanceHistory/eac:maintenanceEvent) > 1]">
                            <xf:label><xf:output value="concat('- ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-maintenanceEvent']/tei:div[@type='fullName'])"/></xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:trigger ref="self::eac:maintenanceEvent[not(eac:eventDescription)]">
                            <xf:label><xf:output value="concat('+ ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-eventDescription']/tei:div[@type='fullName'])"/></xf:label>
                            <xf:insert if="self::eac:maintenanceEvent[not(eac:eventDescription)]" context="." nodeset="eac:eventDateTime" origin="instance('eacMaintenanceEvent')/eac:maintenanceEvent/eac:eventDescription" at="last()" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:group>
                    <xf:select1 ref="@maintenanceEventType">
                        <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-maintenanceEventType']/tei:div[@type='fullName']"   class="{if(is-valid(.), 'valid', 'invalid')}"/>
                        <xf:item>
                            <xf:label>cancelled</xf:label>
                            <xf:value>cancelled</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>created</xf:label>
                            <xf:value>created</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>deleted</xf:label>
                            <xf:value>deleted</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>derived</xf:label>
                            <xf:value>derived</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>revised</xf:label>
                            <xf:value>revised</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>unknown</xf:label>
                            <xf:value>unknown</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>updated</xf:label>
                            <xf:value>updated</xf:value>
                        </xf:item>
                        <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-maintenanceEventType']/tei:div[@type='summary']"/></xf:hint>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-maintenanceEventType']/tei:div[@type='description']"/></xf:help>
                    </xf:select1>
                    <xf:input ref="eac:agent">
                        <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agent']/tei:div[@type='fullName']"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agent']/tei:div[@type='description']"/></xf:help>
                        <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-agent']/tei:div[@type='summary']"/></xf:hint>
                    </xf:input>
                    <xf:select1 ref="eac:agent/@agentType">
                        <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-agentType']/tei:div[@type='fullName']"   class="{if(is-valid(.), 'valid', 'invalid')}"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-agentType']/tei:div[@type='description']"/></xf:help>
                        <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-agentType']/tei:div[@type='summary']"/></xf:hint>
                        <xf:item>
                            <xf:label>human</xf:label>
                            <xf:value>human</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>machine</xf:label>
                            <xf:value>machine</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>unknown</xf:label>
                            <xf:value>unknown</xf:value>
                        </xf:item>
                    </xf:select1>
                    <xf:input ref="eac:eventDateTime/@standardDateTime">
                        <!-- @rmq @standardDateTime is optional we can type text into eventDateTime directly (so there is no ISO dateTime required) -->
                        <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDateTime']/tei:div[@type='fullName']"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDateTime']/tei:div[@type='description']"/></xf:help>
                        <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDateTime']/tei:div[@type='summary']"/></xf:hint>
                    </xf:input>
                    <xf:textarea ref="eac:eventDescription">
                        <xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-eventDescription']/tei:div[@type='fullName']"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-eventDescription']/tei:div[@type='description']"/></xf:help>
                        <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-eventDescription']/tei:div[@type='summary']"/></xf:hint>
                    </xf:textarea>
                    <xf:trigger ref="self::eac:maintenanceEvent[eac:eventDescription]">
                        <xf:label><xf:output value="concat('- ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-eventDescription']/tei:div[@type='fullName'])"/></xf:label>
                        <xf:delete if="self::eac:maintenanceEvent[eac:eventDescription]" context="." nodeset="eac:eventDescription" ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:repeat>
            </xf:group>
            <xf:trigger>
                <xf:label>Forcer la sauvegarde</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert nodeset="instance('eacNoValidation')" origin="instance('eacInstance')"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:send submission="noValidationSubmission"/>
                </xf:action>
            </xf:trigger>
        </xf:group>
    </xf:case>
    <xf:case id="sourcesPanel" selected="true">
        <xf:group class="trigger">
            <xf:trigger ref="eac:control[not(eac:sources)]">
                <xf:label>Sources</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="." nodeset="eac:maintenanceHistory" origin="instance('eacSources')/eac:sources" position="after"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:delete nodeset="eac:sources/eac:source/eac:descriptiveNote"/>
                    <xf:delete nodeset="eac:sources/eac:source/eac:citedRange"/>
                </xf:action>
                <xf:dispatch name="getid" targetid="entity" ev:event="DOMActivate"/>
            </xf:trigger>
        </xf:group>
        <xf:group ref="eac:control/eac:sources">
            <xf:label>
                <!--@todo ne fonctionne pas parfaitement, si une source n'est pas citée, il est possible de supprimer le bloc-->
                <xf:trigger ref="self::eac:sources[not(ancestor::eac:eac//@sourceReference[contains(., current()/eac:source/@id)])]" class="del">
                    <xf:label>🗑</xf:label>
                    <xf:hint>Supprimer toutes les sources</xf:hint>
                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                </xf:trigger>
                <xf:output value="'Sources'"/>
                <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-sources']/tei:div[@type='summary']"/></xf:hint>
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-sources']/tei:div[@type='description']"/></xf:help>
                <xf:trigger ref="self::eac:sources[eac:source]" class="trigger">
                    <xf:label>+📁</xf:label>
                    <xf:hint>Ajouter une nouvelle source.</xf:hint>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert context="." nodeset="eac:source" origin="instance('eacSources')/eac:sources/eac:source" at="1" position="before"/>
                    </xf:action>
                    <xf:action ev:event="DOMActivate">
                        <xf:delete nodeset="eac:source[1]/eac:descriptiveNote"/>
                        <xf:delete nodeset="eac:source[1]/eac:citedRange"/>
                        <!--<xf:delete nodeset="eac:source[last()]/eac:reference/@href"/>-->
                        <xf:dispatch name="getid" targetid="entity" ev:event="DOMActivate"/>
                    </xf:action>
                </xf:trigger>
                <xf:trigger ref="self::eac:sources[not(eac:source)]" class="trigger">
                    <xf:label>+📁</xf:label>
                    <xf:hint>Ajouter une nouvelle source.</xf:hint>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert context="." nodeset="node()" origin="instance('eacSources')/eac:sources/eac:source" at="1"/>
                    </xf:action>
                    <xf:action ev:event="DOMActivate">
                        <xf:delete nodeset="eac:source[1]/eac:descriptiveNote"/>
                        <xf:delete nodeset="eac:source[1]/eac:citedRange"/>
                        <!--<xf:delete nodeset="eac:source[last()]/eac:reference/@href"/>-->
                        <xf:dispatch name="getid" targetid="entity" ev:event="DOMActivate"/>
                    </xf:action>
                </xf:trigger>
            </xf:label>

            <xf:repeat nodeset="eac:source">
                <xf:group class="isolated">
                    <xf:label>
                        <xf:trigger
                                ref="self::eac:source[not(ancestor::eac:eac//@sourceReference[contains(., current()/@id)])]"
                                class="del">
                            <xf:label>🗑</xf:label>
                            <xf:hint>
                                <xf:output value="concat('Supprimer ', string-join(eac:reference, ', '))"/>
                            </xf:hint>
                            <xf:delete if="count(parent::eac:sources/eac:source) > 1" nodeset="."
                                       ev:event="DOMActivate"/>
                            <xf:delete if="count(parent::eac:sources/eac:source) = 1" nodeset="parent::eac:sources"
                                       ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value=" concat(
                                        'Source (',
                                        if(normalize-space(eac:reference)!='', eac:reference, ''), ') ')"/>
                        <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-source']/tei:div[@type='summary']"/></xf:hint>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-source']/tei:div[@type='description']"/></xf:help>
                        <xf:trigger class="trigger" ref="self::eac:source[not(eac:citedRange)]">
                            <xf:label>…/…</xf:label>
                            <xf:hint>Ajouter une pagination.</xf:hint>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="." nodeset="eac:reference"
                                           origin="instance('eacSources')/eac:sources/eac:source/eac:citedRange"
                                           at="last()" position="after"/>
                            </xf:action>
                        </xf:trigger>
                        <xf:trigger ref="self::eac:source[not(eac:descriptiveNote)]" class="trigger">
                            <xf:label>🗒</xf:label>
                            <xf:hint>Ajouter une note.</xf:hint>
                            <xf:insert context="." nodeset="eac:reference"
                                       origin="instance('eacSources')/eac:sources/eac:source/eac:descriptiveNote"
                                       at="last()" position="after" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:repeat nodeset="eac:reference">
                        <xf:input ref=".">
                            <xf:label>
                                <xf:output value="'Référence'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-reference']/tei:div[@type='description']"/></xf:help>
                                <!--<xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-reference']/tei:div[@type='summary']"/></xf:hint>-->
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@href">
                            <xf:label>
                                <xf:output value="'Hyperlien'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-href']/tei:div[@type='description']"/></xf:help>
                                <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-href']/tei:div[@type='summary']"/></xf:hint>
                                <xf:group ref=".[.!='' and not(starts-with(., '#'))]" class="link">
                                    <a href="{.}" target="_blank">
                                        <xf:output value="' (Accéder)'"/>
                                    </a>
                                </xf:group>
                            </xf:label>
                        </xf:input>
                    </xf:repeat>
                    <xf:group ref="eac:citedRange">
                        <xf:input ref=".">
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:hint>Supprimer la foliotation</xf:hint>
                                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="'Pagination/foliotation'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-citedRange']/tei:div[@type='description']"/></xf:help>
                                <xf:hint><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-citedRange']/tei:div[@type='summary']"/></xf:hint>
                            </xf:label>
                        </xf:input>
                        <xf:select1 ref="@unit">
                            <xf:label>Unité</xf:label>
                            <xf:item>
                                <xf:label>tome</xf:label>
                                <xf:value>tome</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>folio</xf:label>
                                <xf:value>folio</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>page</xf:label>
                                <xf:value>page</xf:value>
                            </xf:item>
                        </xf:select1>
                    </xf:group>
                    <xf:group ref="eac:descriptiveNote">
                        <xf:repeat nodeset="eac:p">
                            <xf:textarea ref=".">
                                <xf:label>
                                    <xf:trigger class="del">
                                        <xf:label>🗑</xf:label>
                                        <xf:delete nodeset="parent::eac:descriptiveNote" ev:event="DOMActivate"/>
                                    </xf:trigger>
                                    <xf:output value="'Note'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                            </xf:textarea>
                        </xf:repeat>
                    </xf:group>
                    <!--<xf:group ref="eac:descriptiveNote">
                        <xf:label>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/></xf:help>
                            <xf:output value="
                                concat(
                                    'Note ',
                                    if(normalize-space(parent::eac:source/eac:reference)!='', concat(' (', parent::eac:source/eac:reference, ')'), ''), ' ')" />
                            <xf:trigger class="trigger">
                                <xf:label>+§</xf:label>
                                <xf:insert context="." nodeset="eac:p" at="1" position="before" origin="instance(eacSource)/eac:source/eac:descriptiveNote/eac:p" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint>
                                    <xf:output value="concat(
                                'Supprimer la note ',
                                 if(parent::eac:source/eac:reference!='', concat('(', parent::eac:source/eac:reference, ')'), ''))" /></xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                        <xf:repeat nodeset="eac:p" class="simpleRepeat">
                            <xf:label>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-p']/tei:div[@type='description']"/></xf:help>
                                <xf:output value="'Paragraphe'"/>
                                <xf:trigger ref="self::eac:p[count(parent::eac:descriptiveNote/eac:p) > 1]" class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:hint>Supprimer un paragraphe</xf:hint>
                                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                            </xf:label>
                            <xf:textarea ref="."/>
                        </xf:repeat>
                    </xf:group>-->
                </xf:group>
            </xf:repeat>

            <xf:group ref="eac:descriptiveNote">
                <xf:repeat nodeset="eac:p">
                    <xf:textarea ref=".">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint>Supprimer les notes générales sur les sources</xf:hint>
                                <xf:delete nodeset="parent::eac:descriptiveNote" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Notes générales sur les sources'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                    </xf:textarea>
                </xf:repeat>
            </xf:group>
            <!--
            <xf:group ref="eac:descriptiveNote">
                <xf:label>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/></xf:help>
                    <xf:output value="'Notes générales sur les sources'"/>
                    <xf:trigger class="trigger">
                        <xf:label>+§</xf:label>
                        <xf:insert context="." nodeset="eac:p" at="1" position="before" origin="instance(eacSource)/eac:source/eac:descriptiveNote/eac:p" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger class="del">
                        <xf:label>🗑</xf:label>
                        <xf:hint>Supprimer les notes générales sur les sources</xf:hint>
                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:label>
                <xf:repeat nodeset="eac:p" class="simpleRepeat">
                    <xf:label>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-p']/tei:div[@type='description']"/></xf:help>
                        <xf:output value="'Paragraphe'"/>
                        <xf:trigger ref="self::eac:p[count(parent::eac:descriptiveNote/eac:p) > 1]" class="del">
                            <xf:label>🗑</xf:label>
                            <xf:hint>Supprimer un paragraphe</xf:hint>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:textarea ref="."/>
                </xf:repeat>
            </xf:group>
            -->
            <xf:trigger ref="self::eac:sources[not(eac:descriptiveNote)]" class="trigger control">
                <xf:label>🗒</xf:label>
                <xf:hint>Ajouter des notes générales sur les sources</xf:hint>
                <xf:insert context="." nodeset="eac:source"  at="last()" position="after" origin="instance('eacSources')/eac:sources/eac:source/eac:descriptiveNote" ev:event="DOMActivate"/>
            </xf:trigger>
        </xf:group>
    </xf:case>
    <xf:case id="identityPanel" selected="false">
        <xf:group ref="eac:cpfDescription/eac:identity">
            <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                <xf:output value="'Identité'"/>
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-identity']/tei:div[@type='description']"/></xf:help>
            </xf:label>
            <xf:group ref="eac:entityType" class="isolated">
                <xf:select1 ref="@value" appearance="minimal">
                    <xf:label>
                        <xf:output value="'Type d’entité'"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-entityType']/tei:div[@type='description']"/></xf:help>
                    </xf:label>
                    <xf:item>
                        <xf:label>corporateBody</xf:label>
                        <xf:value>corporateBody</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>family</xf:label>
                        <xf:value>family</xf:value>
                    </xf:item>
                    <xf:item>
                        <xf:label>person</xf:label>
                        <xf:value>person</xf:value>
                    </xf:item>
                </xf:select1>
            </xf:group>
            <xf:group class="isolated">
                <xf:label>
                    <xf:output value="'Formes du nom'"/>
                    <xf:trigger class="trigger">
                        <xf:label>+</xf:label>
                        <xf:hint>Ajouter une forme du nom.</xf:hint>
                        <xf:insert if="self::eac:identity[eac:nameEntry]" context="." nodeset="*[name(.)='nameEntry']" at="1" position="before" origin="instance('eacIdentity')/eac:nameEntry" ev:event="DOMActivate"/>
                        <xf:insert if="self::eac:identity[not(eac:nameEntry)]" context="." nodeset="eac:entityType" position="after" origin="instance('eacIdentity')/eac:nameEntry" ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:label>
                <xf:repeat nodeset="eac:nameEntry">
                    <xf:group class="isolated">
                        <xf:label>
                            <xf:trigger ref="self::eac:nameEntry[count(parent::eac:identity/eac:nameEntry) > 1]" class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint>
                                    <xf:output value="concat('Supprimer une forme du nom ', if(normalize-space(string-join(eac:part))!='', concat(' (', normalize-space(string-join(eac:part, ', ')), ')'), ''))"/>
                                </xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="concat('Forme du nom ', if(normalize-space(string-join(eac:part))!='', concat(' (', normalize-space(string-join(eac:part, ', ')), ')'), ''))"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id=concat('elem-', name(current()))]/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                        <xf:group ref="self::eac:nameEntry">
                            <xf:select1 ref="@status">
                                <xf:label>
                                    <xf:output value="'Statut'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-status']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Autorisée</xf:label>
                                    <xf:value>authorized</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Attestée</xf:label>
                                    <xf:value>alternative</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select1 ref="@preferredForm" appearance="minimal">
                                <xf:label>
                                    <xf:output value="'Forme préférée'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-preferredForm']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Oui</xf:label>
                                    <xf:value>true</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Non</xf:label>
                                    <xf:value>false</xf:value>
                                </xf:item>
                                <xf:action if="current()='true'" ev:event="xforms-value-changed">
                                    <xf:setvalue
                                            ref="ancestor::eac:nameEntry/following-sibling::eac:nameEntry/@preferredForm[.='true']"
                                            value="'false'"/>
                                    <xf:setvalue
                                            ref="ancestor::eac:nameEntry/preceding-sibling::eac:nameEntry/@preferredForm[.='true']"
                                            value="'false'"/>
                                </xf:action>
                            </xf:select1>
                            <xf:repeat nodeset="eac:part" id="namePart">
                                <xf:input ref=".">
                                    <xf:label>
                                        <xf:trigger ref="self::eac:part[count(parent::eac:nameEntry/eac:part) > 1]" class="del">
                                            <xf:label>🗑</xf:label>
                                            <!--<xf:hint><xf:output value="concat('Supprimer une partie ', if(normalize-space(.)!='', concat(' (', ., ')'), ''))"/></xf:hint>-->
                                            <xf:delete nodeset="." if="count(parent::eac:nameEntry/eac:part) > 1" ev:event="DOMActivate"/>
                                        </xf:trigger>
                                        <xf:output value="'Partie'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-part']/tei:div[@type='description']"/></xf:help>
                                        <xf:trigger class="trigger">
                                            <xf:label>+</xf:label>
                                            <xf:insert context="parent::eac:nameEntry" nodeset="eac:part"
                                                       at="index('namePart')" position="after"
                                                       origin="instance('eacIdentity')/eac:nameEntry/eac:part"
                                                       ev:event="DOMActivate"/>
                                        </xf:trigger>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@localType">
                                    <xf:label>
                                        <xf:output value="'Type'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-localType']/tei:div[@type='description']"/></xf:help>
                                    </xf:label>
                                    <xf:itemset ref="instance('nameParts')/part">
                                        <xf:label ref="."/>
                                        <xf:value ref="."/>
                                    </xf:itemset>
                                </xf:select1>
                            </xf:repeat>
                        </xf:group>
                        <xf:select ref="@sourceReference" appearance="full">
                            <xf:label>
                                <xf:output value="concat(
                                            'Référence(s)',
                                            if(normalize-space(string-join(parent::eac:nameEntry/eac:part))!='', concat(' (', normalize-space(string-join(parent::eac:nameEntry/eac:part, ', ')), ')') , '')
                                            )"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                            <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                <!--@todo Q° multiple references inside one source !-->
                                <xf:label>
                                    <xf:output value="string-join(*, ', ')"/>
                                </xf:label>
                                <xf:value ref="@id"/>
                            </xf:itemset>
                        </xf:select>
                    </xf:group>
                </xf:repeat>
            </xf:group>
            <xf:trigger ref="self::eac:identity[not(eac:descriptiveNote)]" class="trigger">
                <xf:label>🗒</xf:label>
                <xf:hint>Ajouter une note.</xf:hint>
                <xf:insert context="." nodeset="*"  at="last()" position="after" origin="instance('eacIdentity')/eac:descriptiveNote" ev:event="DOMActivate"/>
            </xf:trigger>
            <xf:group ref="eac:descriptiveNote">
                <xf:repeat nodeset="eac:p" class="simpleRepeat">
                    <xf:textarea ref=".">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:delete nodeset="parent::eac:descriptiveNote" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Note'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-p']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                    </xf:textarea>
                </xf:repeat>
            </xf:group>
        </xf:group>
    </xf:case>
    <xf:case id="functionsPanel" selected="false">
        <xf:group class="trigger">
            <xf:trigger ref="eac:cpfDescription[not(eac:description)]">
                <xf:label>Ajouter des fonctions</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="." nodeset="eac:identity" position="after" origin="instance('eacDescription')/eac:description"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description" nodeset="*" at="1" position="before" origin="instance('eacFunctions')/eac:functions"/>
                </xf:action>
                <xf:delete nodeset="eac:description/eac:functions/eac:function/eac:descriptiveNote" ev:event="DOMActivate"/>
                <xf:delete nodeset="eac:description/eac:functions/eac:function/eac:placeName" ev:event="DOMActivate"/>
            </xf:trigger>
            <xf:trigger ref="eac:cpfDescription[eac:description[not(eac:functions)]]">
                <xf:label>Ajouter des fonctions</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description" nodeset="*" at="1" position="before" origin="instance('eacFunctions')/eac:functions"/>
                </xf:action>
                <xf:delete nodeset="eac:description/eac:functions/eac:function/eac:descriptiveNote" ev:event="DOMActivate"/>
                <xf:delete nodeset="eac:description/eac:functions/eac:function/eac:placeName" ev:event="DOMActivate"/>
            </xf:trigger>
        </xf:group>
        <xf:group ref="eac:cpfDescription/eac:description/eac:functions">
            <xf:label>
                <xf:trigger class="del">
                    <xf:label>🗑</xf:label>
                    <xf:hint>Supprimer toutes les fonctions</xf:hint>
                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                </xf:trigger>
                <h2>Fonctions</h2>
                <xf:trigger class="trigger">
                    <xf:label>+</xf:label>
                    <xf:hint>Ajouter une fonction</xf:hint>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert context="." nodeset="eac:function" at="1" position="before" origin="instance('eacFunctions')/eac:functions/eac:function"/>
                    </xf:action>
                    <xf:delete nodeset="eac:function[1]/eac:descriptiveNote" ev:event="DOMActivate"/>
                    <xf:delete nodeset="eac:function[1]/eac:placeName" ev:event="DOMActivate"/>
                </xf:trigger>
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-functions']/tei:div[@type='description']"/></xf:help>
            </xf:label>
            <xf:repeat nodeset="eac:function" class="isolated">
                <xf:label>
                    <xf:trigger ref="self::eac:function[count(parent::eac:functions/eac:function)>1]" class="del">
                        <xf:label>🗑</xf:label>
                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                    </xf:trigger>
                    <h3><xf:output value="concat('Fonction', if(normalize-space(eac:term)!='', concat(' (', eac:term, ')'), ''))"/></h3>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-function']/tei:div[@type='description']"/></xf:help>
                    <xf:trigger>
                        <xf:label>📅</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:show dialog="functionDatesDialog"/>
                        </xf:action>
                    </xf:trigger>
                    <xf:trigger ref="self::eac:function[not(eac:placeName)]" class="trigger">
                        <xf:label>📍</xf:label>
                        <xf:hint>Ajouter un lieu</xf:hint>
                        <xf:insert if="eac:descriptiveNote" context="." nodeset="eac:descriptiveNote" position="before" origin="instance('eacFunctions')/eac:functions/eac:function/eac:placeName" ev:event="DOMActivate"/>
                        <xf:insert if="not(eac:descriptiveNote)" context="." nodeset="*" at="last()" position="after" origin="instance('eacFunctions')/eac:functions/eac:function/eac:placeName" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger ref="self::eac:function[not(eac:descriptiveNote)]" class="trigger">
                        <xf:label>🗒</xf:label>
                        <xf:insert context="." nodeset="*" at="last()" position="after" origin="instance('eacFunctions')/eac:functions/eac:function/eac:descriptiveNote" ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:label>
                <xf:dialog id="functionDatesDialog">
                    <xf:trigger ref="self::eac:function[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                        <xf:label>τ - Date simple</xf:label>
                        <xf:insert context="." nodeset="eac:term" position="after" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        <xf:hide ev:event="DOMActivate" dialog="functionDatesDialog"/>
                    </xf:trigger>
                    <br/>
                    <xf:trigger ref="self::eac:function[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                        <xf:label>Δ - Intervalle</xf:label>
                        <xf:insert context="." nodeset="eac:term" position="after" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateRange" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                        <xf:hide ev:event="DOMActivate" dialog="functionDatesDialog"/>
                    </xf:trigger>
                    <br/>
                    <xf:trigger ref="self::eac:function[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                        <xf:label>∑ - Ensemble de dates</xf:label>
                        <xf:insert context="." nodeset="eac:term" position="after" origin="instance('eacDates')/eac:dateSet" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateSet" nodeset="*" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateSet" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        <xf:hide ev:event="DOMActivate" dialog="functionDatesDialog"/>
                    </xf:trigger>
                    <br/>
                    <xf:trigger>
                        <xf:label>Annuler</xf:label>
                        <xf:hide ev:event="DOMActivate" dialog="functionDatesDialog"/>
                    </xf:trigger>
                </xf:dialog>
                <xf:group>
                    <xf:input ref="eac:term">
                        <xf:label>
                            Terme
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-term']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                    </xf:input>
                    <xf:select ref="@localType" appearance="full" class="switch">
                        <xf:item>
                            <xf:label>Function vérifiée</xf:label>
                            <xf:value>verified</xf:value>
                        </xf:item>
                    </xf:select>
                </xf:group>
                <xf:group ref="self::eac:function">
                    <xf:select ref="@sourceReference" appearance="full">
                        <xf:label>
                            <xf:output value="concat('Référence(s)', if(normalize-space(string-join(parent::eac:function/eac:term))!='', concat(' (', normalize-space(string-join(parent::eac:function/eac:term, ', ')), ')') , ''))"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                            <!--@todo Q° multiple references inside one source !-->
                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                            <xf:value ref="@id"/>
                        </xf:itemset>
                    </xf:select>
                </xf:group>
                <xf:group ref="eac:date">
                    <xf:label>
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                        <xf:trigger>
                            <!--↺-->
                            <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:function" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                                <xf:insert context="parent::eac:function/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                                <xf:insert context="parent::eac:function/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                                <xf:setvalue ref="parent::eac:function/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                                <xf:setvalue ref="parent::eac:function/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                                <xf:setvalue ref="parent::eac:function/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                                <xf:setvalue ref="parent::eac:function/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                            </xf:action>
                            <xf:delete nodeset="parent::eac:function/eac:date" ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:trigger>
                            <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:function" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateSet"/>
                                <xf:insert context="parent::eac:function/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:date"/>
                            </xf:action>
                            <xf:delete nodeset="parent::eac:function/eac:date" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:group ref="self::eac:date">
                        <xf:input ref="@standardDate" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notBefore" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notAfter" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:select1 ref="@certainty" incremental="true">
                            <xf:label>
                                <xf:output value="'Certitude'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:item>
                                <xf:label>Certain</xf:label>
                                <xf:value>certain</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Approximate</xf:label>
                                <xf:value>approximate</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Uncertain</xf:label>
                                <xf:value>uncertain</xf:value>
                            </xf:item>
                        </xf:select1>
                        <xf:select ref="@sourceReference" appearance="full">
                            <xf:label>
                                <xf:output value="'Référence(s)'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                            <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                <xf:value ref="@id"/>
                            </xf:itemset>
                        </xf:select>
                    </xf:group>
                </xf:group>
                <xf:group ref="eac:dateRange">
                    <xf:label>
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="'Intervalle'"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                        <xf:trigger>
                            <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:function" nodeset="eac:dateRange" position="after" origin="instance('eacDates')/eac:dateSet"/>
                                <xf:insert context="parent::eac:function/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:dateRange"/>
                            </xf:action>
                            <xf:delete nodeset="parent::eac:function/eac:dateRange" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:group ref="eac:fromDate" class="isolated">
                        <xf:label>
                            <xf:output value="'Date de début'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                        <xf:group ref="self::eac:fromDate">
                            <xf:input ref="@standardDate" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:select1 ref="@certainty" incremental="true">
                                <xf:label>
                                    <xf:output value="'Certitude'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Certain</xf:label>
                                    <xf:value>certain</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Approximate</xf:label>
                                    <xf:value>approximate</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Uncertain</xf:label>
                                    <xf:value>uncertain</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select ref="@sourceReference" appearance="full">
                                <xf:label>
                                    <xf:output value="'Référence(s)'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                    <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                    <xf:value ref="@id"/>
                                </xf:itemset>
                            </xf:select>
                        </xf:group>
                    </xf:group>
                    <xf:group ref="eac:toDate">
                        <xf:label>
                            <xf:output value="'Date de fin'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                        <xf:group ref="self::eac:toDate">
                            <xf:input ref="@standardDate" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:select1 ref="@certainty" incremental="true">
                                <xf:label>
                                    <xf:output value="'Certitude'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Certain</xf:label>
                                    <xf:value>certain</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Approximate</xf:label>
                                    <xf:value>approximate</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Uncertain</xf:label>
                                    <xf:value>uncertain</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select ref="@sourceReference" appearance="full">
                                <xf:label>
                                    <xf:output value="'Référence(s)'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                    <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                    <xf:value ref="@id"/>
                                </xf:itemset>
                            </xf:select>
                        </xf:group>
                    </xf:group>
                </xf:group>
                <xf:group ref="eac:dateSet">
                    <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="'Ensemble de dates'"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateSet']/tei:div[@type='description']" /></xf:help>
                        <xf:trigger class="trigger">
                            <xf:label>τ</xf:label>
                            <xf:hint>Ajouter une date simple à l'ensemble</xf:hint>
                            <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:trigger class="trigger">
                            <xf:label>Δ</xf:label>
                            <xf:hint>Ajouter un intervalle à l'ensemble</xf:hint>
                            <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange[1]" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange[1]" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:repeat nodeset="self::eac:dateSet/*">
                        <xf:group ref="self::eac:date">
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                                <xf:trigger>
                                    <!--↺-->
                                    <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                                    <xf:action ev:event="DOMActivate">
                                        <xf:insert context="parent::eac:dateSet" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                                        <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                                        <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                                    </xf:action>
                                    <xf:delete nodeset="parent::eac:dateSet/eac:date" ev:event="DOMActivate"/>
                                </xf:trigger>
                            </xf:label>
                            <xf:group ref="self::eac:date">
                                <xf:input ref="@standardDate" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notBefore" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notAfter" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@certainty" incremental="true">
                                    <xf:label>
                                        <xf:output value="'Certitude'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                    <xf:item>
                                        <xf:label>Certain</xf:label>
                                        <xf:value>certain</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Approximate</xf:label>
                                        <xf:value>approximate</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Uncertain</xf:label>
                                        <xf:value>uncertain</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:select ref="@sourceReference" appearance="full">
                                    <xf:label>
                                        <xf:output value="'Référence(s)'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                    </xf:label>
                                    <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                        <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                        <xf:value ref="@id"/>
                                    </xf:itemset>
                                </xf:select>
                            </xf:group>
                        </xf:group>
                        <xf:group ref="self::eac:dateRange">
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="'Intervalle'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:group ref="eac:fromDate" class="isolated">
                                <xf:label>
                                    <xf:output value="'Date de début'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:group ref="self::eac:fromDate">
                                    <xf:input ref="@standardDate" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notBefore" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notAfter" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:select1 ref="@certainty" incremental="true">
                                        <xf:label>
                                            <xf:output value="'Certitude'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                        <xf:item>
                                            <xf:label>Certain</xf:label>
                                            <xf:value>certain</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Approximate</xf:label>
                                            <xf:value>approximate</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Uncertain</xf:label>
                                            <xf:value>uncertain</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                    <xf:select ref="@sourceReference" appearance="full">
                                        <xf:label>
                                            <xf:output value="'Référence(s)'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                        </xf:label>
                                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                            <xf:value ref="@id"/>
                                        </xf:itemset>
                                    </xf:select>
                                </xf:group>
                            </xf:group>
                            <xf:group ref="eac:toDate">
                                <xf:label>
                                    <xf:output value="'Date de fin'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:group ref="self::eac:toDate">
                                    <xf:input ref="@standardDate" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notBefore" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notAfter" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:select1 ref="@certainty" incremental="true">
                                        <xf:label>
                                            <xf:output value="'Certitude'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                        <xf:item>
                                            <xf:label>Certain</xf:label>
                                            <xf:value>certain</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Approximate</xf:label>
                                            <xf:value>approximate</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Uncertain</xf:label>
                                            <xf:value>uncertain</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                    <xf:select ref="@sourceReference" appearance="full">
                                        <xf:label>
                                            <xf:output value="'Référence(s)'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                        </xf:label>
                                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                            <xf:value ref="@id"/>
                                        </xf:itemset>
                                    </xf:select>
                                </xf:group>
                            </xf:group>
                        </xf:group>
                    </xf:repeat>
                </xf:group>
                <xf:group ref="eac:placeName">
                    <xf:input ref=".">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="concat('Lieu', if(normalize-space(.)!='', concat(' (', ., ')'), ''))"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-placeName']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                    </xf:input>
                </xf:group>
                <xf:group ref="eac:descriptiveNote">
                    <xf:repeat nodeset="eac:p">
                    <xf:textarea ref=".">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:delete nodeset="parent::eac:descriptiveNote" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Note'" />
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                    </xf:textarea>
                </xf:repeat>
                </xf:group>
            </xf:repeat>
        </xf:group>
    </xf:case>
    <xf:case id="occupationsPanel" selected="false">
        <xf:group class="trigger">
            <xf:trigger ref="eac:cpfDescription[not(eac:description)]">
                <xf:label>Ajouter des Professions</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="." nodeset="eac:identity" position="after" origin="instance('eacDescription')/eac:description"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description" nodeset="*" at="1" position="before" origin="instance('eacOccupations')/eac:occupations"/>
                </xf:action>
                <xf:delete nodeset="eac:description/eac:occupations/eac:occupation/eac:descriptiveNote" ev:event="DOMActivate"/>
                <xf:delete nodeset="eac:description/eac:occupations/eac:occupation/eac:placeName" ev:event="DOMActivate"/>
            </xf:trigger>
            <xf:trigger ref="eac:cpfDescription[eac:description[not(eac:occupations)]]">
                <xf:label>Ajouter des Professions</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description" nodeset="*" at="1" position="before" origin="instance('eacOccupations')/eac:occupations"/>
                </xf:action>
                <xf:delete nodeset="eac:description/eac:occupations/eac:occupation/eac:descriptiveNote" ev:event="DOMActivate"/>
                <xf:delete nodeset="eac:description/eac:occupations/eac:occupation/eac:placeName" ev:event="DOMActivate"/>
            </xf:trigger>
        </xf:group>
        <xf:group ref="eac:cpfDescription/eac:description/eac:occupations">
            <xf:label>
                <xf:trigger class="del">
                    <xf:label>🗑</xf:label>
                    <xf:hint>Supprimer toutes les professions</xf:hint>
                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                </xf:trigger>
                <h2>Profession</h2>
                <xf:trigger class="trigger">
                    <xf:label>+</xf:label>
                    <xf:hint>Ajouter une profession</xf:hint>
                    <xf:action ev:event="DOMActivate">
                        <xf:insert context="." nodeset="eac:occupation" at="1" position="before" origin="instance('eacOccupations')/eac:occupations/eac:occupation"/>
                    </xf:action>
                    <xf:delete nodeset="eac:occupation[1]/eac:descriptiveNote" ev:event="DOMActivate"/>
                    <xf:delete nodeset="eac:occupation[1]/eac:placeName" ev:event="DOMActivate"/>
                </xf:trigger>
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-occupations']/tei:div[@type='description']"/></xf:help>
            </xf:label>
            <xf:repeat nodeset="eac:occupation" class="isolated">
                <xf:label>
                    <xf:trigger ref="self::eac:occupation[count(parent::eac:occupations/eac:occupation)>1]" class="del">
                        <xf:label>🗑</xf:label>
                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                    </xf:trigger>
                    <h3><xf:output value="concat('Profession', if(normalize-space(eac:term)!='', concat(' (', eac:term, ')'), ''))"/></h3>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-occupation']/tei:div[@type='description']"/></xf:help>
                    <xf:trigger>
                        <xf:label>📅</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:show dialog="occupationDatesDialog"/>
                        </xf:action>
                    </xf:trigger>
                    <xf:trigger ref="self::eac:occupation[not(eac:placeName)]" class="trigger">
                        <xf:label>📍</xf:label>
                        <xf:hint>Ajouter un lieu</xf:hint>
                        <xf:insert if="eac:descriptiveNote" context="." nodeset="eac:descriptiveNote" position="before" origin="instance('eacOccupations')/eac:occupations/eac:occupation/eac:placeName" ev:event="DOMActivate"/>
                        <xf:insert if="not(eac:descriptiveNote)" context="." nodeset="*" at="last()" position="after" origin="instance('eacOccupations')/eac:occupations/eac:occupation/eac:placeName" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger ref="self::eac:occupation[not(eac:descriptiveNote)]" class="trigger">
                        <xf:label>🗒</xf:label>
                        <xf:insert context="." nodeset="*" at="last()" position="after" origin="instance('eacOccupations')/eac:occupations/eac:occupation/eac:descriptiveNote" ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:label>
                <xf:dialog id="occupationDatesDialog">
                    <xf:trigger ref="self::eac:occupation[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                        <xf:label>τ - Date simple</xf:label>
                        <xf:insert context="." nodeset="eac:term" position="after" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        <xf:hide ev:event="DOMActivate" dialog="occupationDatesDialog"/>
                    </xf:trigger>
                    <br/>
                    <xf:trigger ref="self::eac:occupation[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                        <xf:label>Δ - Intervalle</xf:label>
                        <xf:insert context="." nodeset="eac:term" position="after" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateRange" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                        <xf:hide ev:event="DOMActivate" dialog="occupationDatesDialog"/>
                    </xf:trigger>
                    <br/>
                    <xf:trigger ref="self::eac:occupation[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                        <xf:label>∑ - Ensemble de dates</xf:label>
                        <xf:insert context="." nodeset="eac:term" position="after" origin="instance('eacDates')/eac:dateSet" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateSet" nodeset="*" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateSet" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        <xf:hide ev:event="DOMActivate" dialog="occupationDatesDialog"/>
                    </xf:trigger>
                    <br/>
                    <xf:trigger>
                        <xf:label>Annuler</xf:label>
                        <xf:hide ev:event="DOMActivate" dialog="occupationDatesDialog"/>
                    </xf:trigger>
                </xf:dialog>
                <xf:group>
                    <xf:input ref="eac:term">
                        <xf:label>
                            Terme
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-term']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                    </xf:input>
                    <xf:select ref="@localType" appearance="full" class="switch">
                        <xf:item>
                            <xf:label>occupation vérifiée</xf:label>
                            <xf:value>verified</xf:value>
                        </xf:item>
                    </xf:select>
                </xf:group>
                <xf:group ref="self::eac:occupation">
                    <xf:select ref="@sourceReference" appearance="full">
                        <xf:label>
                            <xf:output value="concat('Référence(s)', if(normalize-space(string-join(parent::eac:occupation/eac:term))!='', concat(' (', normalize-space(string-join(parent::eac:occupation/eac:term, ', ')), ')') , ''))"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                            <!--@todo Q° multiple references inside one source !-->
                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                            <xf:value ref="@id"/>
                        </xf:itemset>
                    </xf:select>
                </xf:group>
                <xf:group ref="eac:date">
                    <xf:label>
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                        <xf:trigger>
                            <!--↺-->
                            <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:occupation" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                                <xf:insert context="parent::eac:occupation/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                                <xf:insert context="parent::eac:occupation/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                                <xf:setvalue ref="parent::eac:occupation/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                                <xf:setvalue ref="parent::eac:occupation/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                                <xf:setvalue ref="parent::eac:occupation/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                                <xf:setvalue ref="parent::eac:occupation/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                            </xf:action>
                            <xf:delete nodeset="parent::eac:occupation/eac:date" ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:trigger>
                            <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:occupation" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateSet"/>
                                <xf:insert context="parent::eac:occupation/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:date"/>
                            </xf:action>
                            <xf:delete nodeset="parent::eac:occupation/eac:date" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:group ref="self::eac:date">
                        <xf:input ref="@standardDate" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notBefore" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notAfter" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:select1 ref="@certainty" incremental="true">
                            <xf:label>
                                <xf:output value="'Certitude'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:item>
                                <xf:label>Certain</xf:label>
                                <xf:value>certain</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Approximate</xf:label>
                                <xf:value>approximate</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Uncertain</xf:label>
                                <xf:value>uncertain</xf:value>
                            </xf:item>
                        </xf:select1>
                        <xf:select ref="@sourceReference" appearance="full">
                            <xf:label>
                                <xf:output value="'Référence(s)'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                            <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                <xf:value ref="@id"/>
                            </xf:itemset>
                        </xf:select>
                    </xf:group>
                </xf:group>
                <xf:group ref="eac:dateRange">
                    <xf:label>
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="'Intervalle'"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                        <xf:trigger>
                            <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:occupation" nodeset="eac:dateRange" position="after" origin="instance('eacDates')/eac:dateSet"/>
                                <xf:insert context="parent::eac:occupation/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:dateRange"/>
                            </xf:action>
                            <xf:delete nodeset="parent::eac:occupation/eac:dateRange" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:group ref="eac:fromDate" class="isolated">
                        <xf:label>
                            <xf:output value="'Date de début'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                        <xf:group ref="self::eac:fromDate">
                            <xf:input ref="@standardDate" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:select1 ref="@certainty" incremental="true">
                                <xf:label>
                                    <xf:output value="'Certitude'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Certain</xf:label>
                                    <xf:value>certain</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Approximate</xf:label>
                                    <xf:value>approximate</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Uncertain</xf:label>
                                    <xf:value>uncertain</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select ref="@sourceReference" appearance="full">
                                <xf:label>
                                    <xf:output value="'Référence(s)'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                    <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                    <xf:value ref="@id"/>
                                </xf:itemset>
                            </xf:select>
                        </xf:group>
                    </xf:group>
                    <xf:group ref="eac:toDate">
                        <xf:label>
                            <xf:output value="'Date de fin'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                        <xf:group ref="self::eac:toDate">
                            <xf:input ref="@standardDate" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:select1 ref="@certainty" incremental="true">
                                <xf:label>
                                    <xf:output value="'Certitude'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Certain</xf:label>
                                    <xf:value>certain</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Approximate</xf:label>
                                    <xf:value>approximate</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Uncertain</xf:label>
                                    <xf:value>uncertain</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select ref="@sourceReference" appearance="full">
                                <xf:label>
                                    <xf:output value="'Référence(s)'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                    <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                    <xf:value ref="@id"/>
                                </xf:itemset>
                            </xf:select>
                        </xf:group>
                    </xf:group>
                </xf:group>
                <xf:group ref="eac:dateSet">
                    <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="'Ensemble de dates'"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateSet']/tei:div[@type='description']" /></xf:help>
                        <xf:trigger class="trigger">
                            <xf:label>τ</xf:label>
                            <xf:hint>Ajouter une date simple à l'ensemble</xf:hint>
                            <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:trigger class="trigger">
                            <xf:label>Δ</xf:label>
                            <xf:hint>Ajouter un intervalle à l'ensemble</xf:hint>
                            <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange[1]" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange[1]" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:repeat nodeset="self::eac:dateSet/*">
                        <xf:group ref="self::eac:date">
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                                <xf:trigger>
                                    <!--↺-->
                                    <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                                    <xf:action ev:event="DOMActivate">
                                        <xf:insert context="parent::eac:dateSet" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                                        <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                                        <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                                    </xf:action>
                                    <xf:delete nodeset="parent::eac:dateSet/eac:date" ev:event="DOMActivate"/>
                                </xf:trigger>
                            </xf:label>
                            <xf:group ref="self::eac:date">
                                <xf:input ref="@standardDate" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notBefore" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notAfter" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@certainty" incremental="true">
                                    <xf:label>
                                        <xf:output value="'Certitude'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                    <xf:item>
                                        <xf:label>Certain</xf:label>
                                        <xf:value>certain</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Approximate</xf:label>
                                        <xf:value>approximate</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Uncertain</xf:label>
                                        <xf:value>uncertain</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:select ref="@sourceReference" appearance="full">
                                    <xf:label>
                                        <xf:output value="'Référence(s)'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                    </xf:label>
                                    <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                        <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                        <xf:value ref="@id"/>
                                    </xf:itemset>
                                </xf:select>
                            </xf:group>
                        </xf:group>
                        <xf:group ref="self::eac:dateRange">
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="'Intervalle'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:group ref="eac:fromDate" class="isolated">
                                <xf:label>
                                    <xf:output value="'Date de début'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:group ref="self::eac:fromDate">
                                    <xf:input ref="@standardDate" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notBefore" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notAfter" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:select1 ref="@certainty" incremental="true">
                                        <xf:label>
                                            <xf:output value="'Certitude'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                        <xf:item>
                                            <xf:label>Certain</xf:label>
                                            <xf:value>certain</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Approximate</xf:label>
                                            <xf:value>approximate</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Uncertain</xf:label>
                                            <xf:value>uncertain</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                    <xf:select ref="@sourceReference" appearance="full">
                                        <xf:label>
                                            <xf:output value="'Référence(s)'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                        </xf:label>
                                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                            <xf:value ref="@id"/>
                                        </xf:itemset>
                                    </xf:select>
                                </xf:group>
                            </xf:group>
                            <xf:group ref="eac:toDate">
                                <xf:label>
                                    <xf:output value="'Date de fin'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:group ref="self::eac:toDate">
                                    <xf:input ref="@standardDate" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notBefore" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notAfter" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:select1 ref="@certainty" incremental="true">
                                        <xf:label>
                                            <xf:output value="'Certitude'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                        <xf:item>
                                            <xf:label>Certain</xf:label>
                                            <xf:value>certain</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Approximate</xf:label>
                                            <xf:value>approximate</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Uncertain</xf:label>
                                            <xf:value>uncertain</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                    <xf:select ref="@sourceReference" appearance="full">
                                        <xf:label>
                                            <xf:output value="'Référence(s)'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                        </xf:label>
                                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                            <xf:value ref="@id"/>
                                        </xf:itemset>
                                    </xf:select>
                                </xf:group>
                            </xf:group>
                        </xf:group>
                    </xf:repeat>
                </xf:group>
                <xf:group ref="eac:placeName">
                    <xf:input ref=".">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="concat('Lieu', if(normalize-space(.)!='', concat(' (', ., ')'), ''))"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-placeName']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                    </xf:input>
                </xf:group>
                <xf:group ref="eac:descriptiveNote">
                    <xf:repeat nodeset="eac:p">
                        <xf:textarea ref=".">
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete nodeset="parent::eac:descriptiveNote" ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="'Note'" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                        </xf:textarea>
                    </xf:repeat>
                </xf:group>
            </xf:repeat>
        </xf:group>
    </xf:case>

    <xf:case id="placesPanel" selected="false">
        <xf:group class="trigger">
            <xf:trigger ref="eac:cpfDescription[not(eac:description)]">
                <xf:label>Ajouter des lieux</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="." nodeset="eac:identity" position="after" origin="instance('eacDescription')/eac:description"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:action if="eac:description[not(eac:occupations)]">
                        <xf:insert if="eac:description[not(*[self::eac:functions or self::eac:languagesUsed or self::eac:legalStatuses or self::eac:localDescriptions or self::eac:mandates])]" context="eac:description" nodeset="*" at="1" position="before" origin="instance('eacPlaces')/eac:places"/>
                        <xf:insert if="eac:description[*[self::eac:functions or self::eac:languagesUsed or self::eac:legalStatuses or self::eac:localDescriptions or self::eac:mandates]]" context="eac:description" nodeset="*[self::eac:functions or self::eac:languagesUsed or self::eac:legalStatuses or self::eac:localDescriptions or self::eac:mandates]" at="last()" position="after" origin="instance('eacPlaces')/eac:places"/>
                    </xf:action>
                    <xf:action if="eac:description[eac:occupations]">
                        <xf:insert context="eac:description" nodeset="eac:occupations" position="after" origin="instance('eacPlaces')/eac:places"/>
                    </xf:action>
                </xf:action>
                <xf:delete nodeset="eac:description/eac:places/eac:descriptiveNote" ev:event="DOMActivate"/>
            </xf:trigger>
            <xf:trigger ref="eac:cpfDescription[eac:description[not(eac:places)]]">
                <xf:label>Ajouter des lieux</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:action if="eac:description[not(eac:occupations)]">
                        <xf:insert if="eac:description[not(*[self::eac:functions or self::eac:languagesUsed or self::eac:legalStatuses or self::eac:localDescriptions or self::eac:mandates])]" context="eac:description" nodeset="*" at="1" position="before" origin="instance('eacPlaces')/eac:places"/>
                        <xf:insert if="eac:description[*[self::eac:functions or self::eac:languagesUsed or self::eac:legalStatuses or self::eac:localDescriptions or self::eac:mandates]]" context="eac:description" nodeset="*[self::eac:functions or self::eac:languagesUsed or self::eac:legalStatuses or self::eac:localDescriptions or self::eac:mandates]" at="last()" position="after" origin="instance('eacPlaces')/eac:places"/>
                    </xf:action>
                    <xf:action if="eac:description[eac:occupations]">
                        <xf:insert context="eac:description" nodeset="eac:occupations" position="after" origin="instance('eacPlaces')/eac:places"/>
                    </xf:action>
                </xf:action>
                <xf:delete nodeset="eac:description/eac:places/eac:descriptiveNote" ev:event="DOMActivate"/>
            </xf:trigger>
        </xf:group>
        <xf:group ref="eac:cpfDescription/eac:description/eac:places">
            <xf:label>
                <xf:trigger class="del">
                    <xf:label>🗑</xf:label>
                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                </xf:trigger>
                <xf:output value="'Lieux'" />
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-places']/tei:div[@type='description']"/></xf:help>
                <xf:trigger class="trigger">
                    <xf:label>+</xf:label>
                    <xf:insert context="." nodeset="eac:place" at="1" position="before" origin="instance('eacPlaces')/eac:places/eac:place" ev:event="DOMActivate"/>
                </xf:trigger>
                <xf:trigger ref="self::eac:places[not(eac:descriptiveNote)]" class="trigger">
                    <xf:label>🗒</xf:label>
                    <xf:hint><xf:output value="'Ajouter une note sur les lieux'" /></xf:hint>
                    <xf:insert context="." nodeset="eac:reference" origin="instance('eacSources')/eac:sources/eac:source/eac:descriptiveNote" at="last()" position="after" ev:event="DOMActivate"/>
                </xf:trigger>
            </xf:label>
            <xf:repeat nodeset="eac:place" class="isolated">
                <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                    <xf:trigger class="del">
                        <xf:label>🗑</xf:label>
                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:output value="'Lieu'" />
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-place']/tei:div[@type='description']"/></xf:help>
                    <xf:trigger ref="self::eac:place[not(eac:placeRole)]" class="trigger">
                        <xf:label>+ rôle</xf:label>
                        <xf:insert if="self::eac:place[eac:placeRole]" context="." nodeset="eac:placeRole" at="last()" position="after" origin="instance('eacPlace')/eac:place/eac:placeRole" ev:event="DOMActivate"/>
                        <xf:insert if="self::eac:place[not(eac:placeRole)]" context="." nodeset="*" at="1" position="before" origin="instance('eacPlace')/eac:place/eac:placeRole" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger ref="self::eac:place[not(eac:placeName)]" class="trigger">
                        <xf:label>+ nom de lieu</xf:label>
                        <xf:insert if="self::eac:place[not(eac:placeName)][eac:placeRole]" context="." nodeset="eac:placeRole" at="last()" position="after" origin="instance('eacPlace')/eac:place/eac:placeName" ev:event="DOMActivate"/>
                        <xf:insert if="self::eac:place[not(eac:placeName)][not(eac:placeRole)]" context="." nodeset="*" position="before" origin="instance('eacPlace')/eac:place/eac:placeName" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger ref="self::eac:place[not(eac:address)]" class="trigger">
                        <xf:label><xf:output value="'+ adresse'"/></xf:label>
                        <xf:insert if="self::eac:place[eac:placeName or eac:placeRole][not(eac:address)]" context="." nodeset="*[self::eac:placeName or self::eac:placeRole]" at="last()" position="after" origin="instance('eacPlace')/eac:place/eac:address" ev:event="DOMActivate"/>
                        <xf:insert if="self::eac:place[not(eac:placeName)][not(eac:placeRole)][not(eac:address)]" context="." nodeset="*" position="before" origin="instance('eacPlace')/eac:place/eac:address" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger>
                        <xf:label>📅</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:show dialog="placeDatesDialog"/>
                        </xf:action>
                    </xf:trigger>
                    <xf:trigger ref="self::eac:place[not(eac:descriptiveNote)]" class="trigger">
                        <xf:label>🗒</xf:label>
                        <xf:insert context="." nodeset="*" at="last()" position="after" origin="instance('eacPlaces')/eac:places/eac:descriptiveNote" ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:label>
                <xf:dialog id="placeDatesDialog">
                    <xf:trigger ref="self::eac:place[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                        <xf:label>τ - Date simple</xf:label>
                        <xf:insert context="." nodeset="eac:term" position="after" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        <xf:hide ev:event="DOMActivate" dialog="placeDatesDialog"/>
                    </xf:trigger>
                    <br/>
                    <xf:trigger ref="self::eac:place[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                        <xf:label>Δ - Intervalle</xf:label>
                        <xf:insert context="." nodeset="eac:term" position="after" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateRange" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                        <xf:hide ev:event="DOMActivate" dialog="placeDatesDialog"/>
                    </xf:trigger>
                    <br/>
                    <xf:trigger ref="self::eac:place[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                        <xf:label>∑ - Ensemble de dates</xf:label>
                        <xf:insert context="." nodeset="eac:term" position="after" origin="instance('eacDates')/eac:dateSet" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateSet" nodeset="*" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateSet" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        <xf:hide ev:event="DOMActivate" dialog="placeDatesDialog"/>
                    </xf:trigger>
                    <br/>
                    <xf:trigger>
                        <xf:label>Annuler</xf:label>
                        <xf:hide ev:event="DOMActivate" dialog="placeDatesDialog"/>
                    </xf:trigger>
                </xf:dialog>
                <xf:repeat nodeset="eac:placeRole" id="indexPlaceRole">
                    <xf:input ref=".">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Rôle du lieu'" />
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-placeRole']/tei:div[@type='description']"/></xf:help>
                            <xf:trigger class="trigger">
                                <xf:label>+</xf:label>
                                <xf:insert if="parent::eac:place[eac:placeRole]" context="parent::eac:place" nodeset="eac:placeRole" at="index('indexPlaceRole')" position="after" origin="instance('eacPlace')/eac:place/eac:placeRole" ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                    </xf:input>
                </xf:repeat>
                <xf:repeat nodeset="eac:placeName" id="indexPlacePlaceName">
                    <xf:input ref=".">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Nom du lieu'" />
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-placeName']/tei:div[@type='description']"/></xf:help>
                            <xf:trigger class="trigger">
                                <xf:label>+ nom de lieu</xf:label>
                                <xf:insert if="parent::eac:place[eac:placeName]" context="parent::eac:place" nodeset="eac:placeName" at="index('indexPlacePlaceName')" position="after" origin="instance('eacPlace')/eac:place/eac:placeName" ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                    </xf:input>
                </xf:repeat>
                <xf:repeat nodeset="eac:address">
                    <xf:label>
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="'Adresse'" />
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-address']/tei:div[@type='description']"/></xf:help>
                    </xf:label>
                    <xf:repeat nodeset="eac:addressLine" id="indexPlaceAddressLine">
                        <xf:input ref=".">
                            <xf:label>
                                <xf:trigger ref="self::eac:addressLine[count(parent::eac:address/eac:addressLine) > 1]" class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete if="count(parent::eac:address/eac:addressLine) > 1" nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="'Ligne d’adresse'" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-addressLine']/tei:div[@type='description']"/></xf:help>
                                <xf:trigger>
                                    <xf:label><xf:output value="'+'"/></xf:label>
                                    <xf:insert context="parent::eac:address" nodeset="eac:addressLine" at="index('indexPlaceAddressLine')" position="after" origin="instance('eacPlace')/eac:place/eac:address/eac:addressLine" ev:event="DOMActivate"/>
                                </xf:trigger>
                            </xf:label>
                        </xf:input>
                    </xf:repeat>
                </xf:repeat>
                <xf:group ref="eac:date">
                    <xf:label>
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                        <xf:trigger>
                            <!--↺-->
                            <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:place" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                                <xf:insert context="parent::eac:place/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                                <xf:insert context="parent::eac:place/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                                <xf:setvalue ref="parent::eac:place/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                                <xf:setvalue ref="parent::eac:place/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                                <xf:setvalue ref="parent::eac:place/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                                <xf:setvalue ref="parent::eac:place/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                            </xf:action>
                            <xf:delete nodeset="parent::eac:place/eac:date" ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:trigger>
                            <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:place" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateSet"/>
                                <xf:insert context="parent::eac:place/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:date"/>
                            </xf:action>
                            <xf:delete nodeset="parent::eac:place/eac:date" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:group ref="self::eac:date">
                        <xf:input ref="@standardDate" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notBefore" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notAfter" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:select1 ref="@certainty" incremental="true">
                            <xf:label>
                                <xf:output value="'Certitude'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:item>
                                <xf:label>Certain</xf:label>
                                <xf:value>certain</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Approximate</xf:label>
                                <xf:value>approximate</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Uncertain</xf:label>
                                <xf:value>uncertain</xf:value>
                            </xf:item>
                        </xf:select1>
                        <xf:select ref="@sourceReference" appearance="full">
                            <xf:label>
                                <xf:output value="'Référence(s)'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                            <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                <xf:value ref="@id"/>
                            </xf:itemset>
                        </xf:select>
                    </xf:group>
                </xf:group>
                <xf:group ref="eac:dateRange">
                    <xf:label>
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="'Intervalle'"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                        <xf:trigger>
                            <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:place" nodeset="eac:dateRange" position="after" origin="instance('eacDates')/eac:dateSet"/>
                                <xf:insert context="parent::eac:place/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:dateRange"/>
                            </xf:action>
                            <xf:delete nodeset="parent::eac:place/eac:dateRange" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:group ref="eac:fromDate" class="isolated">
                        <xf:label>
                            <xf:output value="'Date de début'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                        <xf:group ref="self::eac:fromDate">
                            <xf:input ref="@standardDate" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:select1 ref="@certainty" incremental="true">
                                <xf:label>
                                    <xf:output value="'Certitude'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Certain</xf:label>
                                    <xf:value>certain</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Approximate</xf:label>
                                    <xf:value>approximate</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Uncertain</xf:label>
                                    <xf:value>uncertain</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select ref="@sourceReference" appearance="full">
                                <xf:label>
                                    <xf:output value="'Référence(s)'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                    <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                    <xf:value ref="@id"/>
                                </xf:itemset>
                            </xf:select>
                        </xf:group>
                    </xf:group>
                    <xf:group ref="eac:toDate">
                        <xf:label>
                            <xf:output value="'Date de fin'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                        <xf:group ref="self::eac:toDate">
                            <xf:input ref="@standardDate" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:select1 ref="@certainty" incremental="true">
                                <xf:label>
                                    <xf:output value="'Certitude'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Certain</xf:label>
                                    <xf:value>certain</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Approximate</xf:label>
                                    <xf:value>approximate</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Uncertain</xf:label>
                                    <xf:value>uncertain</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select ref="@sourceReference" appearance="full">
                                <xf:label>
                                    <xf:output value="'Référence(s)'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                    <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                    <xf:value ref="@id"/>
                                </xf:itemset>
                            </xf:select>
                        </xf:group>
                    </xf:group>
                </xf:group>
                <xf:group ref="eac:dateSet">
                    <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="'Ensemble de dates'"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateSet']/tei:div[@type='description']" /></xf:help>
                        <xf:trigger class="trigger">
                            <xf:label>τ</xf:label>
                            <xf:hint>Ajouter une date simple à l'ensemble</xf:hint>
                            <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:trigger class="trigger">
                            <xf:label>Δ</xf:label>
                            <xf:hint>Ajouter un intervalle à l'ensemble</xf:hint>
                            <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange[1]" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange[1]" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:repeat nodeset="self::eac:dateSet/*">
                        <xf:group ref="self::eac:date">
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                                <xf:trigger>
                                    <!--↺-->
                                    <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                                    <xf:action ev:event="DOMActivate">
                                        <xf:insert context="parent::eac:dateSet" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                                        <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                                        <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                                        <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                                    </xf:action>
                                    <xf:delete nodeset="parent::eac:dateSet/eac:date" ev:event="DOMActivate"/>
                                </xf:trigger>
                            </xf:label>
                            <xf:group ref="self::eac:date">
                                <xf:input ref="@standardDate" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notBefore" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notAfter" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@certainty" incremental="true">
                                    <xf:label>
                                        <xf:output value="'Certitude'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                    <xf:item>
                                        <xf:label>Certain</xf:label>
                                        <xf:value>certain</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Approximate</xf:label>
                                        <xf:value>approximate</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Uncertain</xf:label>
                                        <xf:value>uncertain</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:select ref="@sourceReference" appearance="full">
                                    <xf:label>
                                        <xf:output value="'Référence(s)'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                    </xf:label>
                                    <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                        <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                        <xf:value ref="@id"/>
                                    </xf:itemset>
                                </xf:select>
                            </xf:group>
                        </xf:group>
                        <xf:group ref="self::eac:dateRange">
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="'Intervalle'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:group ref="eac:fromDate" class="isolated">
                                <xf:label>
                                    <xf:output value="'Date de début'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:group ref="self::eac:fromDate">
                                    <xf:input ref="@standardDate" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notBefore" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notAfter" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:select1 ref="@certainty" incremental="true">
                                        <xf:label>
                                            <xf:output value="'Certitude'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                        <xf:item>
                                            <xf:label>Certain</xf:label>
                                            <xf:value>certain</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Approximate</xf:label>
                                            <xf:value>approximate</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Uncertain</xf:label>
                                            <xf:value>uncertain</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                    <xf:select ref="@sourceReference" appearance="full">
                                        <xf:label>
                                            <xf:output value="'Référence(s)'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                        </xf:label>
                                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                            <xf:value ref="@id"/>
                                        </xf:itemset>
                                    </xf:select>
                                </xf:group>
                            </xf:group>
                            <xf:group ref="eac:toDate">
                                <xf:label>
                                    <xf:output value="'Date de fin'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:group ref="self::eac:toDate">
                                    <xf:input ref="@standardDate" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notBefore" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notAfter" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:select1 ref="@certainty" incremental="true">
                                        <xf:label>
                                            <xf:output value="'Certitude'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                        <xf:item>
                                            <xf:label>Certain</xf:label>
                                            <xf:value>certain</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Approximate</xf:label>
                                            <xf:value>approximate</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Uncertain</xf:label>
                                            <xf:value>uncertain</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                    <xf:select ref="@sourceReference" appearance="full">
                                        <xf:label>
                                            <xf:output value="'Référence(s)'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                        </xf:label>
                                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                            <xf:value ref="@id"/>
                                        </xf:itemset>
                                    </xf:select>
                                </xf:group>
                            </xf:group>
                        </xf:group>
                    </xf:repeat>
                </xf:group>
                <xf:group ref="eac:descriptiveNote">
                    <xf:repeat nodeset="eac:p">
                        <xf:textarea ref=".">
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete nodeset="parent::eac:descriptiveNote" ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="'Note'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                        </xf:textarea>
                    </xf:repeat>
                </xf:group>
                <xf:group ref="self::eac:place">
                    <xf:select ref="@sourceReference" appearance="full">
                        <xf:label>
                            <xf:output value="concat(
                            instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='fullName'],
                            ' (',
                            instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-place']/tei:div[@type='fullName'],
                            ')')" />
                        </xf:label>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                            <!--@todo Q° multiple references inside one source !-->
                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                            <xf:value ref="@id"/>
                        </xf:itemset>
                    </xf:select>
                </xf:group>
            </xf:repeat>
            <xf:group ref="eac:descriptiveNote">
                <xf:repeat nodeset="eac:p">
                    <xf:textarea ref=".">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint>Supprimer les notes générales sur les lieux</xf:hint>
                                <xf:delete nodeset="parent::eac:descriptiveNote" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Notes générales sur les lieux'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                    </xf:textarea>
                </xf:repeat>
            </xf:group>
        </xf:group>
    </xf:case>
    <xf:case id="existDatesPanel" selected="false">
        <xf:group ref="eac:cpfDescription/eac:description/eac:existDates">
            <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                <xf:trigger class="del">
                    <xf:label>🗑</xf:label>
                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                </xf:trigger>
                <xf:output value="'Dates d’existence'"/>
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-existDates']/tei:div[@type='description']"/></xf:help>
                <xf:trigger>
                    <xf:label>📅</xf:label>
                    <xf:action ev:event="DOMActivate">
                        <xf:show dialog="existDatesDialog"/>
                    </xf:action>
                </xf:trigger>
                <xf:trigger ref="self::eac:existDates[not(eac:descriptiveNote)]" class="trigger">
                    <xf:label>🗒</xf:label>
                    <xf:insert context="." nodeset="*"  at="last()" position="after" origin="instance('eacSources')/eac:sources/eac:source/eac:descriptiveNote" ev:event="DOMActivate"/>
                </xf:trigger>
            </xf:label>
            <xf:dialog id="existDatesDialog">
                <xf:trigger ref="self::eac:existDates[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                    <xf:label>τ - Date simple</xf:label>
                    <xf:insert context="." nodeset="*" at="last()" position="after" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                    <xf:hide ev:event="DOMActivate" dialog="existDatesDialog"/>
                </xf:trigger>
                <br/>
                <xf:trigger ref="self::eac:existDates[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                    <xf:label>Δ - Intervalle</xf:label>
                    <xf:insert context="." nodeset="*" at="last()" position="after" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                    <xf:insert context="eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                    <xf:insert context="eac:dateRange" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                    <xf:hide ev:event="DOMActivate" dialog="existDatesDialog"/>
                </xf:trigger>
                <br/>
                <xf:trigger ref="self::eac:existDates[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                    <xf:label>∑ - Ensemble de dates</xf:label>
                    <xf:insert context="." nodeset="*" at="last()" position="after" origin="instance('eacDates')/eac:dateSet" ev:event="DOMActivate"/>
                    <xf:hide ev:event="DOMActivate" dialog="existDatesDialog"/>
                </xf:trigger>
                <br/>
                <xf:trigger>
                    <xf:label>Annuler</xf:label>
                    <xf:hide ev:event="DOMActivate" dialog="existDatesDialog"/>
                </xf:trigger>
            </xf:dialog>
            <xf:group ref="eac:date">
                <xf:label>
                    <xf:trigger class="del">
                        <xf:label>🗑</xf:label>
                        <xf:hint>
                            <xf:output value="concat('Supprimer une date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'], ')'), ''))"/>
                        </xf:hint>
                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                    <xf:trigger>
                        <!--↺-->
                        <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert context="parent::eac:existDates" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                            <xf:insert context="parent::eac:existDates/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                            <xf:insert context="parent::eac:existDates/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                            <xf:setvalue ref="parent::eac:existDates/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                            <xf:setvalue ref="parent::eac:existDates/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                            <xf:setvalue ref="parent::eac:existDates/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                            <xf:setvalue ref="parent::eac:existDates/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                        </xf:action>
                        <xf:delete nodeset="parent::eac:existDates/eac:date" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger>
                        <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert context="parent::eac:existDates" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateSet"/>
                            <xf:insert context="parent::eac:existDates/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:date"/>
                        </xf:action>
                        <xf:delete nodeset="parent::eac:existDates/eac:date" ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:label>
                <xf:group ref="self::eac:date">
                    <xf:input ref="@standardDate" incremental="true">
                        <xf:label>
                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                    </xf:input>
                    <xf:input ref="@notBefore" incremental="true">
                        <xf:label>
                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                    </xf:input>
                    <xf:input ref="@notAfter" incremental="true">
                        <xf:label>
                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                    </xf:input>
                    <xf:select1 ref="@certainty" incremental="true">
                        <xf:label>
                            <xf:output value="'Certitude'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                        <xf:item>
                            <xf:label>Certain</xf:label>
                            <xf:value>certain</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Approximate</xf:label>
                            <xf:value>approximate</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Uncertain</xf:label>
                            <xf:value>uncertain</xf:value>
                        </xf:item>
                    </xf:select1>
                    <xf:select ref="@sourceReference" appearance="full">
                        <xf:label>
                            <xf:output value="'Référence(s)'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                            <xf:value ref="@id"/>
                        </xf:itemset>
                    </xf:select>
                </xf:group>
            </xf:group>
            <xf:group ref="eac:dateRange">
                <xf:label>
                    <xf:trigger class="del">
                        <xf:label>🗑</xf:label>
                        <xf:hint>
                            <xf:output value="'Supprimer un intervalle'"/>
                        </xf:hint>
                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:output value="'Intervalle'"/>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                    <xf:trigger>
                        <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert context="parent::eac:existDates" nodeset="eac:dateRange" position="after" origin="instance('eacDates')/eac:dateSet"/>
                            <xf:insert context="parent::eac:existDates/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:dateRange"/>
                        </xf:action>
                        <xf:delete nodeset="parent::eac:existDates/eac:dateRange" ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:label>
                <xf:group ref="eac:fromDate" class="isolated">
                    <xf:label>
                        <xf:output value="'Date de début'"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                    </xf:label>
                    <xf:group ref="self::eac:fromDate">
                        <xf:input ref="@standardDate" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notBefore" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notAfter" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:select1 ref="@certainty" incremental="true">
                            <xf:label>
                                <xf:output value="'Certitude'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:item>
                                <xf:label>Certain</xf:label>
                                <xf:value>certain</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Approximate</xf:label>
                                <xf:value>approximate</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Uncertain</xf:label>
                                <xf:value>uncertain</xf:value>
                            </xf:item>
                        </xf:select1>
                        <xf:select ref="@sourceReference" appearance="full">
                            <xf:label>
                                <xf:output value="'Référence(s)'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                            <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                <xf:value ref="@id"/>
                            </xf:itemset>
                        </xf:select>
                    </xf:group>
                </xf:group>
                <xf:group ref="eac:toDate">
                    <xf:label>
                        <xf:output value="'Date de fin'"/>
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                    </xf:label>
                    <xf:group ref="self::eac:toDate">
                        <xf:input ref="@standardDate" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notBefore" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:input ref="@notAfter" incremental="true">
                            <xf:label>
                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:select1 ref="@certainty" incremental="true">
                            <xf:label>
                                <xf:output value="'Certitude'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:item>
                                <xf:label>Certain</xf:label>
                                <xf:value>certain</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Approximate</xf:label>
                                <xf:value>approximate</xf:value>
                            </xf:item>
                            <xf:item>
                                <xf:label>Uncertain</xf:label>
                                <xf:value>uncertain</xf:value>
                            </xf:item>
                        </xf:select1>
                        <xf:select ref="@sourceReference" appearance="full">
                            <xf:label>
                                <xf:output value="'Référence(s)'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                            <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                <xf:value ref="@id"/>
                            </xf:itemset>
                        </xf:select>
                    </xf:group>
                </xf:group>
            </xf:group>
            <xf:group ref="eac:dateSet">
                <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                    <xf:trigger class="del">
                        <xf:label>🗑</xf:label>
                        <xf:hint><xf:output value="'Supprimer un ensemble de dates'"/></xf:hint>
                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:output value="'Ensemble de dates'"/>
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateSet']/tei:div[@type='description']" /></xf:help>
                    <xf:trigger class="trigger">
                        <xf:label>τ</xf:label>
                        <xf:hint>Ajouter une date simple à l'ensemble</xf:hint>
                        <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:trigger class="trigger">
                        <xf:label>Δ</xf:label>
                        <xf:hint>Ajouter un intervalle à l'ensemble</xf:hint>
                        <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateRange[1]" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                        <xf:insert context="eac:dateRange[1]" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                    </xf:trigger>
                </xf:label>
                <xf:repeat nodeset="self::eac:dateSet/*" class="isolated">
                    <xf:group ref="self::eac:date" class="isolated">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint><xf:output value="concat('Supprimer une date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'], ')'), ''))"/></xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                            <xf:trigger>
                                <!--↺-->
                                <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                                <xf:action ev:event="DOMActivate">
                                    <xf:insert context="parent::eac:dateSet" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                                    <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                                    <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                                    <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                                    <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                                    <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                                    <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                                </xf:action>
                                <xf:delete nodeset="parent::eac:dateSet/eac:date" ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                        <xf:group ref="self::eac:date">
                            <xf:input ref="@standardDate" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:select1 ref="@certainty" incremental="true">
                                <xf:label>
                                    <xf:output value="'Certitude'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Certain</xf:label>
                                    <xf:value>certain</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Approximate</xf:label>
                                    <xf:value>approximate</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Uncertain</xf:label>
                                    <xf:value>uncertain</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select ref="@sourceReference" appearance="full">
                                <xf:label>
                                    <xf:output value="'Référence(s)'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                    <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                    <xf:value ref="@id"/>
                                </xf:itemset>
                            </xf:select>
                        </xf:group>
                    </xf:group>
                    <xf:group ref="self::eac:dateRange" class="isolated">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint><xf:output value="'Supprimer un intervalle'"/></xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Intervalle'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                        </xf:label>
                        <xf:group ref="eac:fromDate" class="isolated">
                            <xf:label>
                                <xf:output value="'Date de début'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:group ref="self::eac:fromDate">
                                <xf:input ref="@standardDate" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notBefore" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notAfter" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@certainty" incremental="true">
                                    <xf:label>
                                        <xf:output value="'Certitude'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                    <xf:item>
                                        <xf:label>Certain</xf:label>
                                        <xf:value>certain</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Approximate</xf:label>
                                        <xf:value>approximate</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Uncertain</xf:label>
                                        <xf:value>uncertain</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:select ref="@sourceReference" appearance="full">
                                    <xf:label>
                                        <xf:output value="'Référence(s)'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                    </xf:label>
                                    <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                        <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                        <xf:value ref="@id"/>
                                    </xf:itemset>
                                </xf:select>
                            </xf:group>
                        </xf:group>
                        <xf:group ref="eac:toDate">
                            <xf:label>
                                <xf:output value="'Date de fin'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:group ref="self::eac:toDate">
                                <xf:input ref="@standardDate" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notBefore" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notAfter" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@certainty" incremental="true">
                                    <xf:label>
                                        <xf:output value="'Certitude'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                    <xf:item>
                                        <xf:label>Certain</xf:label>
                                        <xf:value>certain</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Approximate</xf:label>
                                        <xf:value>approximate</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Uncertain</xf:label>
                                        <xf:value>uncertain</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:select ref="@sourceReference" appearance="full">
                                    <xf:label>
                                        <xf:output value="'Référence(s)'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                    </xf:label>
                                    <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                        <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                        <xf:value ref="@id"/>
                                    </xf:itemset>
                                </xf:select>
                            </xf:group>
                        </xf:group>
                    </xf:group>
                </xf:repeat>
            </xf:group>
            <xf:group ref="eac:descriptiveNote">
                <xf:repeat nodeset="eac:p">
                    <xf:textarea ref=".">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:delete nodeset="parent::eac:descriptiveNote" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Note'" />
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                    </xf:textarea>
                </xf:repeat>
            </xf:group>
        </xf:group>
        <xf:group class="trigger">
            <xf:trigger ref="eac:cpfDescription[not(eac:description)]">
                <xf:label>Ajouter des dates d'existence</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="." nodeset="eac:identity" position="after" origin="instance('eacDescription')/eac:description"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description" nodeset="*" at="last()" position="after" origin="instance('eacDates')/eac:existDates"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description/eac:existDates" nodeset="*" at="last()" position="after" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                    <xf:insert context="eac:description/eac:existDates/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                    <xf:insert context="eac:description/eac:existDates/eac:dateRange" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                </xf:action>
            </xf:trigger>
            <xf:trigger ref="eac:cpfDescription[eac:description[not(eac:existDates)]]">
                <xf:label>Ajouter des dates d'existence</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description" nodeset="*" at="last()" position="after" origin="instance('eacDates')/eac:existDates" ev:event="DOMActivate"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description/eac:existDates" nodeset="*" at="last()" position="after" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                    <xf:insert context="eac:description/eac:existDates/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                    <xf:insert context="eac:description/eac:existDates/eac:dateRange" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                </xf:action>
            </xf:trigger>
        </xf:group>
    </xf:case>
    <xf:case id="biogHistPanel" selected="false">
        <xf:group class="trigger">
            <xf:trigger ref="eac:cpfDescription[not(eac:description)]">
                <xf:label>Ajouter une biographie</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="." nodeset="eac:identity" position="after" origin="instance('eacDescription')/eac:description"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description" nodeset="*" at="last()" position="after" origin="instance('eacBiogHist')/eac:biogHist"/>
                </xf:action>
                <!--<xf:delete nodeset="eac:description/eac:biogHist/node()" ev:event="DOMActivate"/>-->
                <xf:delete nodeset="eac:description/eac:biogHist/eac:head" ev:event="DOMActivate"/>
                <xf:delete nodeset="eac:description/eac:biogHist/eac:abstract" ev:event="DOMActivate"/>
                <xf:action ev:event="DOMActivate">
                    <!--@todo generate-id() with BaseX-->
                    <xf:dispatch name="getid" targetid="entity"/>
                </xf:action>
            </xf:trigger>
            <xf:trigger ref="eac:cpfDescription[eac:description[not(eac:biogHist)]]">
                <xf:label>Ajouter une biographie</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="eac:description" nodeset="*" at="last()" position="after" origin="instance('eacBiogHist')/eac:biogHist"/>
                </xf:action>
                <xf:delete nodeset="eac:description/eac:biogHist/eac:head" ev:event="DOMActivate"/>
                <xf:delete nodeset="eac:description/eac:biogHist/eac:abstract" ev:event="DOMActivate"/>
                <xf:action ev:event="DOMActivate">
                    <!--@todo generate-id() with BaseX-->
                    <xf:dispatch name="getid" targetid="entity"/>
                </xf:action>
            </xf:trigger>
        </xf:group>
        <xf:group ref="eac:cpfDescription/eac:description/eac:biogHist">
            <xf:label>
                <xf:trigger class="del">
                    <xf:label>🗑</xf:label>
                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                </xf:trigger>
                Biographie
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-biogHist']/tei:div[@type='description']"/></xf:help>
            </xf:label>
            <xf:repeat nodeset="eac:chronList">
                <xf:label>
                    <xf:trigger class="del">
                        <xf:label>🗑</xf:label>
                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                    </xf:trigger>
                    Liste chronologique
                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-chronList']/tei:div[@type='description']"/></xf:help>
                    <xf:trigger class="trigger">
                        <xf:label>+ évènement</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacChronItem')/eac:chronItem"/>
                        </xf:action>
                        <xf:action ev:event="DOMActivate">
                            <xf:dispatch name="getid" targetid="entity"/>
                        </xf:action>
                    </xf:trigger>
                </xf:label>
                <xf:repeat nodeset="eac:chronItem">
                    <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                        <xf:trigger ref="self::eac:chronItem[not(ancestor::eac:eac//@target[contains(., current()/@id)])]" class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output value="concat('Évènement ', if(normalize-space(eac:event)!='', concat(' (', eac:event, ')'), ''), ' ')" />
                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-chronItem']/tei:div[@type='description']"/></xf:help>
                        <xf:trigger>
                            <xf:label>📅</xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:show dialog="chronItemDatesDialog"/>
                            </xf:action>
                        </xf:trigger>
                        <xf:trigger ref="self::eac:chronItem[not(eac:placeName)]" class="trigger">
                            <xf:label>📍</xf:label>
                            <xf:hint>Ajouter un lieu</xf:hint>
                            <xf:insert context="." nodeset="*[self::eac:date or self::eac:dateRange or self::eac:dateSet or self::eac:event]" at="last()" position="after" origin="instance('eacChronItem')/eac:chronItem/eac:place" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:dialog id="chronItemDatesDialog">
                        <xf:trigger ref="self::eac:chronItem[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                            <xf:label>τ - Date simple</xf:label>
                            <xf:insert context="." nodeset="eac:event" position="before" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                            <xf:hide ev:event="DOMActivate" dialog="chronItemDatesDialog"/>
                        </xf:trigger>
                        <br/>
                        <xf:trigger ref="self::eac:chronItem[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                            <xf:label>Δ - Intervalle</xf:label>
                            <xf:insert context="." nodeset="eac:event" position="before" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                            <xf:hide ev:event="DOMActivate" dialog="chronItemDatesDialog"/>
                        </xf:trigger>
                        <br/>
                        <xf:trigger ref="self::eac:chronItem[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]" class="trigger">
                            <xf:label>∑ - Ensemble de dates</xf:label>
                            <xf:insert context="." nodeset="eac:event" position="before" origin="instance('eacDates')/eac:dateSet" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateSet" nodeset="*" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateSet" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                            <xf:hide ev:event="DOMActivate" dialog="chronItemDatesDialog"/>
                        </xf:trigger>
                        <br/>
                        <xf:trigger>
                            <xf:label>Annuler</xf:label>
                            <xf:hide ev:event="DOMActivate" dialog="chronItemDatesDialog"/>
                        </xf:trigger>
                    </xf:dialog>
                    <xf:trigger ref="self::eac:chronItem[not(eac:event)][not(eac:chronItemSet)]" class="trigger">
                        <xf:label><xf:output value="concat('+ ', instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-event']/tei:div[@type='fullName'])"/></xf:label>
                        <xf:insert if="self::eac:chronItem[eac:date or eac:dateRange or eac:dateSet]" context="." nodeset="*[self::eac:date or self::eac:dateRange or self::eac:dateSet]" at="1" position="after" origin="instance('eacChronItem')/eac:chronItem/eac:event" ev:event="DOMActivate"/>
                        <xf:insert if="self::eac:chronItem[not(eac:date or eac:dateRange or eac:dateSet)]" context="." nodeset="*" at="1" position="before" origin="instance('eacChronItem')/eac:chronItem/eac:event" ev:event="DOMActivate"/>
                    </xf:trigger>
                    <xf:group ref=".">
                        <xf:input ref="eac:event">
                            <!--<xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-event']/tei:div[@type='fullName']"/>-->
                            <xf:label>
                                Évènement
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-event']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:select1 ref="@localType">
                            <!--<xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-localType']/tei:div[@type='fullName']"/>-->
                            <xf:label>
                                Type
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-localType']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                            <xf:itemset ref="instance('eventTypes')/event">
                                <xf:label ref="label"/>
                                <xf:value ref="value"/>
                            </xf:itemset>
                        </xf:select1>
                        <xf:select ref="@sourceReference" appearance="full">
                            <xf:label>
                                Référence(s)
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                            </xf:label>
                            <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                <!--@todo Q° multiple references inside one source !-->
                                <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                <xf:value ref="@id"/>
                            </xf:itemset>
                        </xf:select>
                    </xf:group>

                    <xf:group ref="eac:date">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint>
                                    <xf:output value="concat('Supprimer une date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'], ')'), ''))"/>
                                </xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                            <xf:trigger>
                                <!--↺-->
                                <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                                <xf:action ev:event="DOMActivate">
                                    <xf:insert context="parent::eac:chronItem" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                                    <xf:insert context="parent::eac:chronItem/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                                    <xf:insert context="parent::eac:chronItem/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                                    <xf:setvalue ref="parent::eac:chronItem/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                                    <xf:setvalue ref="parent::eac:chronItem/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                                    <xf:setvalue ref="parent::eac:chronItem/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                                    <xf:setvalue ref="parent::eac:chronItem/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                                </xf:action>
                                <xf:delete nodeset="parent::eac:chronItem/eac:date" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:trigger>
                                <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                                <xf:action ev:event="DOMActivate">
                                    <xf:insert context="parent::eac:chronItem" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateSet"/>
                                    <xf:insert context="parent::eac:chronItem/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:date"/>
                                </xf:action>
                                <xf:delete nodeset="parent::eac:chronItem/eac:date" ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                        <xf:group ref="self::eac:date">
                            <xf:input ref="@standardDate" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter" incremental="true">
                                <xf:label>
                                    <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:select1 ref="@certainty" incremental="true">
                                <xf:label>
                                    <xf:output value="'Certitude'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Certain</xf:label>
                                    <xf:value>certain</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Approximate</xf:label>
                                    <xf:value>approximate</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Uncertain</xf:label>
                                    <xf:value>uncertain</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select ref="@sourceReference" appearance="full">
                                <xf:label>
                                    <xf:output value="'Référence(s)'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                </xf:label>
                                <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                    <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                    <xf:value ref="@id"/>
                                </xf:itemset>
                            </xf:select>
                        </xf:group>
                    </xf:group>
                    <xf:group ref="eac:dateRange">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint>
                                    <xf:output value="'Supprimer un intervalle'"/>
                                </xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Intervalle'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                            <xf:trigger>
                                <xf:label><xf:output value="concat('⇆', '∑')" /></xf:label>
                                <xf:action ev:event="DOMActivate">
                                    <xf:insert context="parent::eac:chronItem" nodeset="eac:dateRange" position="after" origin="instance('eacDates')/eac:dateSet"/>
                                    <xf:insert context="parent::eac:chronItem/eac:dateSet" nodeset="*" origin="parent::eac:existDates/eac:dateRange"/>
                                </xf:action>
                                <xf:delete nodeset="parent::eac:chronItem/eac:dateRange" ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                        <xf:group ref="eac:fromDate" class="isolated">
                            <xf:label>
                                <xf:output value="'Date de début'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:group ref="self::eac:fromDate">
                                <xf:input ref="@standardDate" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notBefore" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notAfter" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@certainty" incremental="true">
                                    <xf:label>
                                        <xf:output value="'Certitude'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                    <xf:item>
                                        <xf:label>Certain</xf:label>
                                        <xf:value>certain</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Approximate</xf:label>
                                        <xf:value>approximate</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Uncertain</xf:label>
                                        <xf:value>uncertain</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:select ref="@sourceReference" appearance="full">
                                    <xf:label>
                                        <xf:output value="'Référence(s)'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                    </xf:label>
                                    <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                        <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                        <xf:value ref="@id"/>
                                    </xf:itemset>
                                </xf:select>
                            </xf:group>
                        </xf:group>
                        <xf:group ref="eac:toDate">
                            <xf:label>
                                <xf:output value="'Date de fin'"/>
                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                            </xf:label>
                            <xf:group ref="self::eac:toDate">
                                <xf:input ref="@standardDate" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notBefore" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notAfter" incremental="true">
                                    <xf:label>
                                        <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@certainty" incremental="true">
                                    <xf:label>
                                        <xf:output value="'Certitude'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                    <xf:item>
                                        <xf:label>Certain</xf:label>
                                        <xf:value>certain</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Approximate</xf:label>
                                        <xf:value>approximate</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Uncertain</xf:label>
                                        <xf:value>uncertain</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:select ref="@sourceReference" appearance="full">
                                    <xf:label>
                                        <xf:output value="'Référence(s)'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                    </xf:label>
                                    <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                        <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                        <xf:value ref="@id"/>
                                    </xf:itemset>
                                </xf:select>
                            </xf:group>
                        </xf:group>
                    </xf:group>
                    <xf:group ref="eac:dateSet">
                        <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint><xf:output value="'Supprimer un ensemble de dates'"/></xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Ensemble de dates'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateSet']/tei:div[@type='description']" /></xf:help>
                            <xf:trigger class="trigger">
                                <xf:label>τ</xf:label>
                                <xf:hint>Ajouter une date simple à l'ensemble</xf:hint>
                                <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:trigger class="trigger">
                                <xf:label>Δ</xf:label>
                                <xf:hint>Ajouter un intervalle à l'ensemble</xf:hint>
                                <xf:insert context="." nodeset="*" at="1" position="before" origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                                <xf:insert context="eac:dateRange[1]" nodeset="*" origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                                <xf:insert context="eac:dateRange[1]" nodeset="eac:fromDate" position="after" origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                        <xf:repeat nodeset="self::eac:dateSet/*" class="isolated">
                            <xf:group ref="self::eac:date" class="isolated">
                                <xf:label>
                                    <xf:trigger class="del">
                                        <xf:label>🗑</xf:label>
                                        <xf:hint><xf:output value="concat('Supprimer une date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'], ')'), ''))"/></xf:hint>
                                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                                    </xf:trigger>
                                    <xf:output value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']" /></xf:help>
                                    <xf:trigger>
                                        <!--↺-->
                                        <xf:label><xf:output value="concat('⇆', 'Δ')" /></xf:label>
                                        <xf:action ev:event="DOMActivate">
                                            <xf:insert context="parent::eac:dateSet" nodeset="eac:date" position="after" origin="instance('eacDates')/eac:dateRange"/>
                                            <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"/>
                                            <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*" position="after" origin="instance('eacDates')/eac:toDate"/>
                                            <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@standardDate" value="current()/@standardDate"/>
                                            <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notBefore" value="current()/@notBefore"/>
                                            <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notAfter" value="current()/@notAfter"/>
                                            <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@certainty" value="current()/@certainty"/>
                                        </xf:action>
                                        <xf:delete nodeset="parent::eac:dateSet/eac:date" ev:event="DOMActivate"/>
                                    </xf:trigger>
                                </xf:label>
                                <xf:group ref="self::eac:date">
                                    <xf:input ref="@standardDate" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notBefore" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notAfter" incremental="true">
                                        <xf:label>
                                            <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:select1 ref="@certainty" incremental="true">
                                        <xf:label>
                                            <xf:output value="'Certitude'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                        </xf:label>
                                        <xf:item>
                                            <xf:label>Certain</xf:label>
                                            <xf:value>certain</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Approximate</xf:label>
                                            <xf:value>approximate</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Uncertain</xf:label>
                                            <xf:value>uncertain</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                    <xf:select ref="@sourceReference" appearance="full">
                                        <xf:label>
                                            <xf:output value="'Référence(s)'"/>
                                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                        </xf:label>
                                        <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                            <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                            <xf:value ref="@id"/>
                                        </xf:itemset>
                                    </xf:select>
                                </xf:group>
                            </xf:group>
                            <xf:group ref="self::eac:dateRange" class="isolated">
                                <xf:label>
                                    <xf:trigger class="del">
                                        <xf:label>🗑</xf:label>
                                        <xf:hint><xf:output value="'Supprimer un intervalle'"/></xf:hint>
                                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                                    </xf:trigger>
                                    <xf:output value="'Intervalle'"/>
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']" /></xf:help>
                                </xf:label>
                                <xf:group ref="eac:fromDate" class="isolated">
                                    <xf:label>
                                        <xf:output value="'Date de début'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                    <xf:group ref="self::eac:fromDate">
                                        <xf:input ref="@standardDate" incremental="true">
                                            <xf:label>
                                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:input ref="@notBefore" incremental="true">
                                            <xf:label>
                                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:input ref="@notAfter" incremental="true">
                                            <xf:label>
                                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:select1 ref="@certainty" incremental="true">
                                            <xf:label>
                                                <xf:output value="'Certitude'"/>
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                            </xf:label>
                                            <xf:item>
                                                <xf:label>Certain</xf:label>
                                                <xf:value>certain</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Approximate</xf:label>
                                                <xf:value>approximate</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Uncertain</xf:label>
                                                <xf:value>uncertain</xf:value>
                                            </xf:item>
                                        </xf:select1>
                                        <xf:select ref="@sourceReference" appearance="full">
                                            <xf:label>
                                                <xf:output value="'Référence(s)'"/>
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                            </xf:label>
                                            <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                                <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                                <xf:value ref="@id"/>
                                            </xf:itemset>
                                        </xf:select>
                                    </xf:group>
                                </xf:group>
                                <xf:group ref="eac:toDate">
                                    <xf:label>
                                        <xf:output value="'Date de fin'"/>
                                        <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']" /></xf:help>
                                    </xf:label>
                                    <xf:group ref="self::eac:toDate">
                                        <xf:input ref="@standardDate" incremental="true">
                                            <xf:label>
                                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']" />
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']" /></xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:input ref="@notBefore" incremental="true">
                                            <xf:label>
                                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']" />
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']" /></xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:input ref="@notAfter" incremental="true">
                                            <xf:label>
                                                <xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']" />
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']" /></xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:select1 ref="@certainty" incremental="true">
                                            <xf:label>
                                                <xf:output value="'Certitude'"/>
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']" /></xf:help>
                                            </xf:label>
                                            <xf:item>
                                                <xf:label>Certain</xf:label>
                                                <xf:value>certain</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Approximate</xf:label>
                                                <xf:value>approximate</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Uncertain</xf:label>
                                                <xf:value>uncertain</xf:value>
                                            </xf:item>
                                        </xf:select1>
                                        <xf:select ref="@sourceReference" appearance="full">
                                            <xf:label>
                                                <xf:output value="'Référence(s)'"/>
                                                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/></xf:help>
                                            </xf:label>
                                            <xf:itemset ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                                <xf:label><xf:output value="string-join(*, ', ')" /></xf:label>
                                                <xf:value ref="@id"/>
                                            </xf:itemset>
                                        </xf:select>
                                    </xf:group>
                                </xf:group>
                            </xf:group>
                        </xf:repeat>
                    </xf:group>

                    <xf:group ref="eac:place">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Lieu'"/>
                            <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-place']/tei:div[@type='description']"/></xf:help>
                        </xf:label>
                        <xf:repeat nodeset="eac:placeName">
                            <xf:input ref=".">
                                <xf:label>
                                    <xf:trigger ref="self::eac:placeName[parent::eac:place[count(eac:placeName)>1]]" class="del">
                                        <xf:label>🗑</xf:label>
                                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                                    </xf:trigger>
                                    Nom de lieu
                                    <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-placeName']/tei:div[@type='description']"/></xf:help>
                                    <xf:trigger class="trigger">
                                        <xf:label>+</xf:label>
                                        <xf:insert if="parent::eac:place[eac:placeName]" context="parent::eac:place" nodeset="eac:placeName" at="last()" position="after" origin="instance('eacPlace')/eac:place/eac:placeName" ev:event="DOMActivate"/>
                                        <xf:insert if="parent::eac:place[not(eac:placeName)]" context="parent::eac:place" nodeset="*" position="before" origin="instance('eacPlace')/eac:place/eac:placeName" ev:event="DOMActivate"/>
                                    </xf:trigger>
                                </xf:label>
                            </xf:input>
                        </xf:repeat>
                    </xf:group>
                </xf:repeat>
            </xf:repeat>
            <xf:trigger ref="self::eac:biogHist[not(eac:chronList)]" class="trigger">
                <xf:label>Ajouter une liste chronologique</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="." nodeset="*" at="last()" position="after" origin="instance('eacBiogHist')/eac:biogHist/eac:chronList"/>
                </xf:action>
                <xf:action ev:event="DOMActivate">
                    <xf:dispatch name="getid" targetid="entity"/>
                </xf:action>
            </xf:trigger>
        </xf:group>
    </xf:case>
    <xf:case id="relationsPanel" selected="false">
        <xf:group class="trigger">
            <xf:trigger ref="eac:cpfDescription[not(eac:relations)]">
                <xf:label>Ajouter des relations</xf:label>
                <xf:action ev:event="DOMActivate">
                    <xf:insert context="." nodeset="*" at="last()" position="after" origin="instance('eacRelations')/eac:relations"/>
                    <xf:action while="count(eac:relations/eac:relation/eac:targetEntity/eac:part) &lt; 3">
                        <xf:insert context="eac:relations/eac:relation/eac:targetEntity" nodeset="eac:part" at="last()" position="after" origin="instance('eacRelations')/eac:relations/eac:relation/eac:targetEntity/eac:part"/>
                    </xf:action>
                </xf:action>
                <xf:setvalue ref="eac:relations/eac:relation/eac:targetEntity/eac:part[1]/@localType" value="'full'" ev:event="DOMActivate"/>
                <xf:setvalue ref="eac:relations/eac:relation/eac:targetEntity/eac:part[2]/@localType" value="'status'" ev:event="DOMActivate"/>
                <xf:setvalue ref="eac:relations/eac:relation/eac:targetEntity/eac:part[3]/@localType" value="'databaseRef'" ev:event="DOMActivate"/>
                <xf:dispatch name="getid" targetid="entity" ev:event="DOMActivate"/>
            </xf:trigger>
        </xf:group>
        <xf:group ref="eac:cpfDescription/eac:relations" >
            <xf:label>
                <xf:trigger class="del">
                    <xf:label>🗑</xf:label>
                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                </xf:trigger>
                Relations
                <xf:help><xf:output value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-relations']/tei:div[@type='description']"/></xf:help>
            </xf:label>
            <xf:repeat id="relations" nodeset="eac:relation">
                <xf:group class="isolated">
                    <xf:label>
                        <xf:trigger class="del">
                            <xf:label>🗑</xf:label>
                            <xf:delete nodeset="." ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:output
                                value="concat('Relation', if(normalize-space(eac:targetEntity/eac:part)!='', concat(' (', eac:targetEntity/eac:part,')'), ''))"/>
                        <xf:help>
                            <xf:output
                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-relation']/tei:div[@type='description']"/>
                        </xf:help>
                        <xf:trigger>
                            <xf:label>+ relation</xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:insert context="parent::eac:relations" nodeset="eac:relation" at="1"
                                           position="before"
                                           origin="instance('eacRelations')/eac:relations/eac:relation"/>
                                <xf:action
                                        while="count(parent::eac:relations/eac:relation[1]/eac:targetEntity/eac:part) &lt; 3">
                                    <xf:insert context="parent::eac:relations/eac:relation[1]"
                                               nodeset="eac:targetEntity/eac:part" at="last()" position="after"
                                               origin="instance('eacRelations')/eac:relations/eac:relation/eac:targetEntity/eac:part"/>
                                </xf:action>
                            </xf:action>
                            <xf:action ev:event="DOMActivate">
                                <xf:setvalue ref="parent::eac:relations/eac:relation[1]//eac:part[1]/@localType"
                                             value="'full'"/>
                                <xf:setvalue ref="parent::eac:relations/eac:relation[1]//eac:part[2]/@localType"
                                             value="'status'"/>
                                <xf:setvalue ref="parent::eac:relations/eac:relation[1]//eac:part[3]/@localType"
                                             value="'databaseRef'"/>
                            </xf:action>
                            <xf:dispatch name="getid" targetid="entity" ev:event="DOMActivate"/>
                        </xf:trigger>
                        <xf:trigger>
                            <xf:label>📅</xf:label>
                            <xf:action ev:event="DOMActivate">
                                <xf:show dialog="relationDatesDialog"/>
                            </xf:action>
                        </xf:trigger>
                        <xf:trigger ref="self::eac:relation[not(eac:descriptiveNote)]" class="trigger">
                            <xf:label>
                                <xf:output value="'+ note'"/>
                            </xf:label>
                            <xf:insert context="." nodeset="*"
                                       origin="instance('eacSources')/eac:sources/eac:source/eac:descriptiveNote"
                                       at="last()" position="after" ev:event="DOMActivate"/>
                        </xf:trigger>
                    </xf:label>
                    <xf:dialog id="relationDatesDialog">
                        <xf:trigger ref="self::eac:relation[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]"
                                    class="trigger">
                            <xf:label>τ - Date simple</xf:label>
                            <xf:insert context="." nodeset="eac:targetEntity" position="after"
                                       origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                            <xf:hide ev:event="DOMActivate" dialog="relationDatesDialog"/>
                        </xf:trigger>
                        <br/>
                        <xf:trigger ref="self::eac:relation[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]"
                                    class="trigger">
                            <xf:label>Δ - Intervalle</xf:label>
                            <xf:insert context="." nodeset="eac:targetEntity" position="after"
                                       origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange" nodeset="*" origin="instance('eacDates')/eac:fromDate"
                                       ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateRange" nodeset="eac:fromDate" position="after"
                                       origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                            <xf:hide ev:event="DOMActivate" dialog="relationDatesDialog"/>
                        </xf:trigger>
                        <br/>
                        <xf:trigger ref="self::eac:relation[not(eac:date)][not(eac:dateRange)][not(eac:dateSet)]"
                                    class="trigger">
                            <xf:label>∑ - Ensemble de dates</xf:label>
                            <xf:insert context="." nodeset="eac:targetEntity" position="after"
                                       origin="instance('eacDates')/eac:dateSet" ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateSet" nodeset="*" origin="instance('eacDates')/eac:date"
                                       ev:event="DOMActivate"/>
                            <xf:insert context="eac:dateSet" nodeset="eac:date" position="after"
                                       origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                            <xf:hide ev:event="DOMActivate" dialog="relationDatesDialog"/>
                        </xf:trigger>
                        <br/>
                        <xf:trigger>
                            <xf:label>Annuler</xf:label>
                            <xf:hide ev:event="DOMActivate" dialog="functionDatesDialog"/>
                        </xf:trigger>
                    </xf:dialog>
                    <xf:group ref="self::eac:relation[@target]">
                        <xf:select ref="@target" appearance="full">
                            <!--<xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-target']/tei:div[@type='fullName']"/>-->
                            <xf:label>
                                Target
                                <xf:help>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-target']/tei:div[@type='description']"/>
                                </xf:help>
                            </xf:label>
                            <xf:itemset ref="instance('eacInstance')//eac:chronItem[@id!='']">
                                <!--@todo Q° multiple references inside one source !-->
                                <xf:label ref="eac:event"/>
                                <xf:value ref="@id"/>
                            </xf:itemset>
                        </xf:select>
                    </xf:group>
                    <xf:group ref="eac:targetEntity">
                        <xf:label>
                            Entité
                            <xf:help>
                                <xf:output
                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-targetEntity']/tei:div[@type='description']"/>
                            </xf:help>
                        </xf:label>
                        <xf:group ref="self::eac:targetEntity">
                            <xf:select1 ref="@targetType">
                                <xf:label>
                                    <xf:output value="'Type d’entité'"/>
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-targetType']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>corporateBody</xf:label>
                                    <xf:value>corporateBody</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>family</xf:label>
                                    <xf:value>family</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>person</xf:label>
                                    <xf:value>person</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:input ref="eac:part[@localType='full']">
                                <xf:label>
                                    Dénomination
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-part']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="eac:part[@localType='status']">
                                <xf:label>
                                    Qualités
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-part']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="eac:part[@localType='databaseRef']">
                                <xf:label>
                                    <xf:output value="'Identifiant base de données  '"/>
                                    <xf:trigger>
                                        <xf:label>lier</xf:label>
                                        <xf:show dialog="showEntities" ev:event="DOMActivate"/>
                                    </xf:trigger>
                                    <xf:output value="' | '"/>
                                    <xf:trigger>
                                        <xf:label>réinitialiser</xf:label>
                                        <xf:setvalue ref="." value="''" ev:event="DOMActivate"/>
                                    </xf:trigger>
                                </xf:label>
                            </xf:input>
                            <xf:dialog id="showEntities" class="autocomplete">
                                <xf:input ref="instance('query')" incremental="true" delay="500">
                                    <xf:label>Entités trouvées dans la base de données</xf:label>
                                    <xf:send submission="getEntities" ev:event="DOMActivate"/>
                                    <xf:toggle ev:event="DOMFocusIn" case="show-autocompletion"/>
                                </xf:input>
                                <xf:switch>
                                    <xf:case id="show-autocompletion">
                                        <xf:repeat id="indexResults" class="autocompleteResults"
                                                   nodeset="instance('results')/*">
                                            <xf:trigger appearance="minimal">
                                                <xf:label>
                                                    <xf:output value="."/>
                                                </xf:label>
                                                <xf:action ev:event="DOMActivate">
                                                    <xf:setvalue
                                                            ref="instance('eacInstance')//eac:relation[index('relations')]//eac:part[@localType='databaseRef']"
                                                            value="concat('#', instance('results')/*[index('indexResults')]/@xml:id)"/>
                                                    <xf:setvalue ref="instance('query')" value="''"/>
                                                    <xf:delete nodeset="instance('results')/*"/>
                                                    <xf:toggle case="hide-autocompletion"/>
                                                    <xf:hide dialog="showEntities"/>
                                                </xf:action>
                                            </xf:trigger>
                                        </xf:repeat>
                                    </xf:case>
                                    <xf:case id="hide-autocompletion"/>
                                </xf:switch>
                                <xf:trigger>
                                    <xf:label>Annuler</xf:label>
                                    <xf:setvalue ev:event="DOMActivate" ref="instance('query')" value="''"/>
                                    <xf:delete ev:event="DOMActivate" nodeset="instance('results')/*"/>
                                    <xf:hide ev:event="DOMActivate" dialog="showEntities"/>
                                </xf:trigger>
                            </xf:dialog>
                        </xf:group>
                    </xf:group>
                    <xf:repeat nodeset="eac:relationType">
                        <xf:select1 ref="." incremental="true">
                            <!--<xf:label ref="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-relationType']/tei:div[@type='fullName']"/>-->
                            <xf:label>
                                <xf:trigger class="del">
                                    <xf:label>🗑</xf:label>
                                    <xf:delete nodeset="." ev:event="DOMActivate"/>
                                </xf:trigger>
                                <xf:output value="'Type de relation'"/>
                                <xf:help>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-relationType']/tei:div[@type='description']"/>
                                </xf:help>
                                <xf:trigger class="trigger">
                                    <xf:label>+</xf:label>
                                    <xf:action ev:event="DOMActivate">
                                        <xf:insert context="parent::eac:relation"
                                                   nodeset="*[self::eac:targetEntity or self::eac:date or self::eac:dateSet or self::eac:dateRange or self::eac:place or self::eac:targetRole]"
                                                   at="last()" position="after"
                                                   origin="instance('eacRelation')/eac:relation/eac:relationType"/>
                                        <xf:insert context="parent::eac:relation" nodeset="eac:relationType" at="last()"
                                                   position="after"
                                                   origin="instance('eacRelation')/eac:relation/eac:targetRole"/>
                                    </xf:action>
                                    <xf:dispatch name="getid" targetid="entity" ev:event="DOMActivate"/>
                                </xf:trigger>
                            </xf:label>
                            <xf:itemset ref="instance('relationTypes')/type">
                                <xf:label>
                                    <xf:output
                                            value="concat(instance('eacInstance')/eac:cpfDescription/eac:identity/eac:nameEntry[@preferredForm='true'][@status='authorized'][1], ' ', label)"/>
                                </xf:label>
                                <xf:value ref="value"/>
                            </xf:itemset>
                            <xf:action ev:event="xforms-value-changed">
                                <xf:setvalue ref="@valueURI"
                                             value="instance('relationTypes')//type[value=current()]/@valueURI"/>
                                <xf:setvalue ref="@vocabularySource"
                                             value="instance('relationTypes')//type[value=current()]/@vocabularySource"/>
                                <xf:setvalue ref="@vocabularySourceURI"
                                             value="instance('relationTypes')//type[value=current()]/@vocabularySourceURI"/>
                            </xf:action>
                        </xf:select1>
                        <xf:select1
                                ref="following-sibling::*[1][self::eac:targetRole[preceding-sibling::*[1][self::eac:relationType] = instance('relationTypes')/type[roles]/value]]">
                            <xf:label>
                                <xf:output value="'Rôle'"/>
                                <xf:help>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-relationType']/tei:div[@type='description']"/>
                                </xf:help>
                            </xf:label>
                            <xf:itemset
                                    ref="instance('relationTypes')/type[value = current()/preceding-sibling::*[1][self::eac:relationType]]/roles/role">
                                <xf:label ref="."/>
                                <xf:value ref="."/>
                            </xf:itemset>
                        </xf:select1>
                        <xf:input
                                ref="following-sibling::*[1][self::eac:targetRole[preceding-sibling::*[1][self::eac:relationType] = instance('relationTypes')/type[not(roles)]/value or preceding-sibling::*[1][self::eac:relationType] = '']]">
                            <xf:label>
                                <xf:output value="'Rôle'"/>
                                <xf:help>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-targetRole']/tei:div[@type='description']"/>
                                </xf:help>
                            </xf:label>
                        </xf:input>
                        <xf:select ref="@sourceReference" appearance="full">
                            <xf:label>
                                <xf:output
                                        value="concat('Référence(s)', if(normalize-space(parent::eac:relationType/following-sibling::*[1][self::eac:targetRole])!='', concat(' (', normalize-space(parent::eac:relationType/following-sibling::*[1][self::eac:targetRole]), ')') , ''))"/>
                                <xf:help>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/>
                                </xf:help>
                            </xf:label>
                            <xf:itemset
                                    ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                <!--@todo Q° multiple references inside one source !-->
                                <xf:label>
                                    <xf:output value="string-join(*, ', ')"/>
                                </xf:label>
                                <xf:value ref="@id"/>
                            </xf:itemset>
                        </xf:select>
                    </xf:repeat>
                    <xf:group ref="eac:date">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint>
                                    <xf:output
                                            value="concat('Supprimer une date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'], ')'), ''))"/>
                                </xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output
                                    value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                            <xf:help>
                                <xf:output
                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']"/>
                            </xf:help>
                            <xf:trigger>
                                <!--↺-->
                                <xf:label>
                                    <xf:output value="concat('⇆', 'Δ')"/>
                                </xf:label>
                                <xf:action ev:event="DOMActivate">
                                    <xf:insert context="parent::eac:relation" nodeset="eac:date" position="after"
                                               origin="instance('eacDates')/eac:dateRange"/>
                                    <xf:insert context="parent::eac:relation/eac:dateRange" nodeset="*"
                                               origin="instance('eacDates')/eac:fromDate"/>
                                    <xf:insert context="parent::eac:relation/eac:dateRange" nodeset="*" position="after"
                                               origin="instance('eacDates')/eac:toDate"/>
                                    <xf:setvalue ref="parent::eac:relation/eac:dateRange/eac:fromDate/@standardDate"
                                                 value="current()/@standardDate"/>
                                    <xf:setvalue ref="parent::eac:relation/eac:dateRange/eac:fromDate/@notBefore"
                                                 value="current()/@notBefore"/>
                                    <xf:setvalue ref="parent::eac:relation/eac:dateRange/eac:fromDate/@notAfter"
                                                 value="current()/@notAfter"/>
                                    <xf:setvalue ref="parent::eac:relation/eac:dateRange/eac:fromDate/@certainty"
                                                 value="current()/@certainty"/>
                                </xf:action>
                                <xf:delete nodeset="parent::eac:relation/eac:date" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:trigger>
                                <xf:label>
                                    <xf:output value="concat('⇆', '∑')"/>
                                </xf:label>
                                <xf:action ev:event="DOMActivate">
                                    <xf:insert context="parent::eac:chronItem" nodeset="eac:date" position="after"
                                               origin="instance('eacDates')/eac:dateSet"/>
                                    <xf:insert context="parent::eac:chronItem/eac:dateSet" nodeset="*"
                                               origin="parent::eac:existDates/eac:date"/>
                                </xf:action>
                                <xf:delete nodeset="parent::eac:chronItem/eac:date" ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                        <xf:group ref="self::eac:date">
                            <xf:input ref="@standardDate" incremental="true">
                                <xf:label>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']"/>
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notBefore" incremental="true">
                                <xf:label>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']"/>
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:input ref="@notAfter" incremental="true">
                                <xf:label>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']"/>
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                            </xf:input>
                            <xf:select1 ref="@certainty" incremental="true">
                                <xf:label>
                                    <xf:output value="'Certitude'"/>
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                                <xf:item>
                                    <xf:label>Certain</xf:label>
                                    <xf:value>certain</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Approximate</xf:label>
                                    <xf:value>approximate</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>Uncertain</xf:label>
                                    <xf:value>uncertain</xf:value>
                                </xf:item>
                            </xf:select1>
                            <xf:select ref="@sourceReference" appearance="full">
                                <xf:label>
                                    <xf:output value="'Référence(s)'"/>
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                                <xf:itemset
                                        ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                    <xf:label>
                                        <xf:output value="string-join(*, ', ')"/>
                                    </xf:label>
                                    <xf:value ref="@id"/>
                                </xf:itemset>
                            </xf:select>
                        </xf:group>
                    </xf:group>
                    <xf:group ref="eac:dateRange">
                        <xf:label>
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint>
                                    <xf:output value="'Supprimer un intervalle'"/>
                                </xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Intervalle'"/>
                            <xf:help>
                                <xf:output
                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']"/>
                            </xf:help>
                            <xf:trigger>
                                <xf:label>
                                    <xf:output value="concat('⇆', '∑')"/>
                                </xf:label>
                                <xf:action ev:event="DOMActivate">
                                    <xf:insert context="parent::eac:relation" nodeset="eac:dateRange" position="after"
                                               origin="instance('eacDates')/eac:dateSet"/>
                                    <xf:insert context="parent::eac:relation/eac:dateSet" nodeset="*"
                                               origin="parent::eac:existDates/eac:dateRange"/>
                                </xf:action>
                                <xf:delete nodeset="parent::eac:relation/eac:dateRange" ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                        <xf:group ref="eac:fromDate" class="isolated">
                            <xf:label>
                                <xf:output value="'Date de début'"/>
                                <xf:help>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']"/>
                                </xf:help>
                            </xf:label>
                            <xf:group ref="self::eac:fromDate">
                                <xf:input ref="@standardDate" incremental="true">
                                    <xf:label>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notBefore" incremental="true">
                                    <xf:label>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notAfter" incremental="true">
                                    <xf:label>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@certainty" incremental="true">
                                    <xf:label>
                                        <xf:output value="'Certitude'"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                    <xf:item>
                                        <xf:label>Certain</xf:label>
                                        <xf:value>certain</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Approximate</xf:label>
                                        <xf:value>approximate</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Uncertain</xf:label>
                                        <xf:value>uncertain</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:select ref="@sourceReference" appearance="full">
                                    <xf:label>
                                        <xf:output value="'Référence(s)'"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                    <xf:itemset
                                            ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                        <xf:label>
                                            <xf:output value="string-join(*, ', ')"/>
                                        </xf:label>
                                        <xf:value ref="@id"/>
                                    </xf:itemset>
                                </xf:select>
                            </xf:group>
                        </xf:group>
                        <xf:group ref="eac:toDate">
                            <xf:label>
                                <xf:output value="'Date de fin'"/>
                                <xf:help>
                                    <xf:output
                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']"/>
                                </xf:help>
                            </xf:label>
                            <xf:group ref="self::eac:toDate">
                                <xf:input ref="@standardDate" incremental="true">
                                    <xf:label>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notBefore" incremental="true">
                                    <xf:label>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:input ref="@notAfter" incremental="true">
                                    <xf:label>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                </xf:input>
                                <xf:select1 ref="@certainty" incremental="true">
                                    <xf:label>
                                        <xf:output value="'Certitude'"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                    <xf:item>
                                        <xf:label>Certain</xf:label>
                                        <xf:value>certain</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Approximate</xf:label>
                                        <xf:value>approximate</xf:value>
                                    </xf:item>
                                    <xf:item>
                                        <xf:label>Uncertain</xf:label>
                                        <xf:value>uncertain</xf:value>
                                    </xf:item>
                                </xf:select1>
                                <xf:select ref="@sourceReference" appearance="full">
                                    <xf:label>
                                        <xf:output value="'Référence(s)'"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                    <xf:itemset
                                            ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                        <xf:label>
                                            <xf:output value="string-join(*, ', ')"/>
                                        </xf:label>
                                        <xf:value ref="@id"/>
                                    </xf:itemset>
                                </xf:select>
                            </xf:group>
                        </xf:group>
                    </xf:group>
                    <xf:group ref="eac:dateSet">
                        <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">
                            <xf:trigger class="del">
                                <xf:label>🗑</xf:label>
                                <xf:hint>
                                    <xf:output value="'Supprimer un ensemble de dates'"/>
                                </xf:hint>
                                <xf:delete nodeset="." ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:output value="'Ensemble de dates'"/>
                            <xf:help>
                                <xf:output
                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateSet']/tei:div[@type='description']"/>
                            </xf:help>
                            <xf:trigger class="trigger">
                                <xf:label>τ</xf:label>
                                <xf:hint>Ajouter une date simple à l'ensemble</xf:hint>
                                <xf:insert context="." nodeset="*" at="1" position="before"
                                           origin="instance('eacDates')/eac:date" ev:event="DOMActivate"/>
                            </xf:trigger>
                            <xf:trigger class="trigger">
                                <xf:label>Δ</xf:label>
                                <xf:hint>Ajouter un intervalle à l'ensemble</xf:hint>
                                <xf:insert context="." nodeset="*" at="1" position="before"
                                           origin="instance('eacDates')/eac:dateRange" ev:event="DOMActivate"/>
                                <xf:insert context="eac:dateRange[1]" nodeset="*"
                                           origin="instance('eacDates')/eac:fromDate" ev:event="DOMActivate"/>
                                <xf:insert context="eac:dateRange[1]" nodeset="eac:fromDate" position="after"
                                           origin="instance('eacDates')/eac:toDate" ev:event="DOMActivate"/>
                            </xf:trigger>
                        </xf:label>
                        <xf:repeat nodeset="self::eac:dateSet/*" class="isolated">
                            <xf:group ref="self::eac:date" class="isolated">
                                <xf:label>
                                    <xf:trigger class="del">
                                        <xf:label>🗑</xf:label>
                                        <xf:hint>
                                            <xf:output
                                                    value="concat('Supprimer une date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'], ')'), ''))"/>
                                        </xf:hint>
                                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                                    </xf:trigger>
                                    <xf:output
                                            value="concat('Date', if(normalize-space(@*[local-name()!='certainty'])!='', concat(' (', @*[local-name()!='certainty'][.!=''], ')'), ''))"/>
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-date']/tei:div[@type='description']"/>
                                    </xf:help>
                                    <xf:trigger>
                                        <!--↺-->
                                        <xf:label>
                                            <xf:output value="concat('⇆', 'Δ')"/>
                                        </xf:label>
                                        <xf:action ev:event="DOMActivate">
                                            <xf:insert context="parent::eac:dateSet" nodeset="eac:date" position="after"
                                                       origin="instance('eacDates')/eac:dateRange"/>
                                            <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*"
                                                       origin="instance('eacDates')/eac:fromDate"/>
                                            <xf:insert context="parent::eac:dateSet/eac:dateRange" nodeset="*"
                                                       position="after" origin="instance('eacDates')/eac:toDate"/>
                                            <xf:setvalue
                                                    ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@standardDate"
                                                    value="current()/@standardDate"/>
                                            <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notBefore"
                                                         value="current()/@notBefore"/>
                                            <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@notAfter"
                                                         value="current()/@notAfter"/>
                                            <xf:setvalue ref="parent::eac:dateSet/eac:dateRange/eac:fromDate/@certainty"
                                                         value="current()/@certainty"/>
                                        </xf:action>
                                        <xf:delete nodeset="parent::eac:dateSet/eac:date" ev:event="DOMActivate"/>
                                    </xf:trigger>
                                </xf:label>
                                <xf:group ref="self::eac:date">
                                    <xf:input ref="@standardDate" incremental="true">
                                        <xf:label>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']"/>
                                            <xf:help>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']"/>
                                            </xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notBefore" incremental="true">
                                        <xf:label>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']"/>
                                            <xf:help>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']"/>
                                            </xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:input ref="@notAfter" incremental="true">
                                        <xf:label>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']"/>
                                            <xf:help>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']"/>
                                            </xf:help>
                                        </xf:label>
                                    </xf:input>
                                    <xf:select1 ref="@certainty" incremental="true">
                                        <xf:label>
                                            <xf:output value="'Certitude'"/>
                                            <xf:help>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']"/>
                                            </xf:help>
                                        </xf:label>
                                        <xf:item>
                                            <xf:label>Certain</xf:label>
                                            <xf:value>certain</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Approximate</xf:label>
                                            <xf:value>approximate</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Uncertain</xf:label>
                                            <xf:value>uncertain</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                    <xf:select ref="@sourceReference" appearance="full">
                                        <xf:label>
                                            <xf:output value="'Référence(s)'"/>
                                            <xf:help>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/>
                                            </xf:help>
                                        </xf:label>
                                        <xf:itemset
                                                ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                            <xf:label>
                                                <xf:output value="string-join(*, ', ')"/>
                                            </xf:label>
                                            <xf:value ref="@id"/>
                                        </xf:itemset>
                                    </xf:select>
                                </xf:group>
                            </xf:group>
                            <xf:group ref="self::eac:dateRange" class="isolated">
                                <xf:label>
                                    <xf:trigger class="del">
                                        <xf:label>🗑</xf:label>
                                        <xf:hint>
                                            <xf:output value="'Supprimer un intervalle'"/>
                                        </xf:hint>
                                        <xf:delete nodeset="." ev:event="DOMActivate"/>
                                    </xf:trigger>
                                    <xf:output value="'Intervalle'"/>
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-dateRange']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                                <xf:group ref="eac:fromDate" class="isolated">
                                    <xf:label>
                                        <xf:output value="'Date de début'"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                    <xf:group ref="self::eac:fromDate">
                                        <xf:input ref="@standardDate" incremental="true">
                                            <xf:label>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:input ref="@notBefore" incremental="true">
                                            <xf:label>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:input ref="@notAfter" incremental="true">
                                            <xf:label>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:select1 ref="@certainty" incremental="true">
                                            <xf:label>
                                                <xf:output value="'Certitude'"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                            <xf:item>
                                                <xf:label>Certain</xf:label>
                                                <xf:value>certain</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Approximate</xf:label>
                                                <xf:value>approximate</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Uncertain</xf:label>
                                                <xf:value>uncertain</xf:value>
                                            </xf:item>
                                        </xf:select1>
                                        <xf:select ref="@sourceReference" appearance="full">
                                            <xf:label>
                                                <xf:output value="'Référence(s)'"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                            <xf:itemset
                                                    ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                                <xf:label>
                                                    <xf:output value="string-join(*, ', ')"/>
                                                </xf:label>
                                                <xf:value ref="@id"/>
                                            </xf:itemset>
                                        </xf:select>
                                    </xf:group>
                                </xf:group>
                                <xf:group ref="eac:toDate">
                                    <xf:label>
                                        <xf:output value="'Date de fin'"/>
                                        <xf:help>
                                            <xf:output
                                                    value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-fromDate']/tei:div[@type='description']"/>
                                        </xf:help>
                                    </xf:label>
                                    <xf:group ref="self::eac:toDate">
                                        <xf:input ref="@standardDate" incremental="true">
                                            <xf:label>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='fullName']"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-standardDate']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:input ref="@notBefore" incremental="true">
                                            <xf:label>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='fullName']"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notBefore']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:input ref="@notAfter" incremental="true">
                                            <xf:label>
                                                <xf:output
                                                        value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='fullName']"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-notAfter']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                        </xf:input>
                                        <xf:select1 ref="@certainty" incremental="true">
                                            <xf:label>
                                                <xf:output value="'Certitude'"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-certainty']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                            <xf:item>
                                                <xf:label>Certain</xf:label>
                                                <xf:value>certain</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Approximate</xf:label>
                                                <xf:value>approximate</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Uncertain</xf:label>
                                                <xf:value>uncertain</xf:value>
                                            </xf:item>
                                        </xf:select1>
                                        <xf:select ref="@sourceReference" appearance="full">
                                            <xf:label>
                                                <xf:output value="'Référence(s)'"/>
                                                <xf:help>
                                                    <xf:output
                                                            value="instance('documentation')/tei:text/tei:body/tei:div[@type='attributes']/tei:div[@xml:id='attr-sourceReference']/tei:div[@type='description']"/>
                                                </xf:help>
                                            </xf:label>
                                            <xf:itemset
                                                    ref="instance('eacInstance')/eac:control/eac:sources/eac:source[@id!=''][normalize-space(.)!='']">
                                                <xf:label>
                                                    <xf:output value="string-join(*, ', ')"/>
                                                </xf:label>
                                                <xf:value ref="@id"/>
                                            </xf:itemset>
                                        </xf:select>
                                    </xf:group>
                                </xf:group>
                            </xf:group>
                        </xf:repeat>
                    </xf:group>
                    <xf:group ref="eac:descriptiveNote">
                        <xf:repeat nodeset="eac:p">
                            <xf:textarea ref=".">
                                <xf:label>
                                    <xf:trigger class="del">
                                        <xf:label>🗑</xf:label>
                                        <xf:delete nodeset="parent::eac:descriptiveNote" ev:event="DOMActivate"/>
                                    </xf:trigger>
                                    <xf:output value="'Note'"/>
                                    <xf:help>
                                        <xf:output
                                                value="instance('documentation')/tei:text/tei:body/tei:div[@type='elements']/tei:div[@xml:id='elem-descriptiveNote']/tei:div[@type='description']"/>
                                    </xf:help>
                                </xf:label>
                            </xf:textarea>
                        </xf:repeat>
                    </xf:group>
                </xf:group>
            </xf:repeat>
        </xf:group>
    </xf:case>
    <xf:case id="commentPanel" selected="false">
        <xf:group ref="comment()">
            <xf:textarea ref=".">
                <xf:label>Commentaire sur le formulaire</xf:label>
            </xf:textarea>
        </xf:group>
    </xf:case>
    <xf:case id="validationPanel" selected="false">
        <xf:group ref="eac:control">
        <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">control</xf:label>
        </xf:group>
        <xf:group ref="eac:cpfDescription">
            <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">cpfDescription</xf:label>
            <xf:group ref="eac:identity">
                <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">Identité</xf:label>
            </xf:group>
            <xf:group ref="eac:description">
                <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">Description</xf:label>
                <xf:group ref="eac:functions">
                    <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">Functions</xf:label>
                </xf:group>
                <xf:group ref="eac:occupations">
                    <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">occupations</xf:label>
                </xf:group>
                <xf:group ref="eac:existDates">
                    <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">existDates</xf:label>
                </xf:group>
                <xf:group ref="eac:places">
                    <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">places</xf:label>
                </xf:group>
                <xf:group ref="eac:biogHist">
                    <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">eac:biogHist</xf:label>
                </xf:group>
            </xf:group>
            <xf:group ref="eac:relations">
                <xf:label class="{if(is-valid(.), 'valid', 'invalid')}">Relations</xf:label>
            </xf:group>
        </xf:group>
    </xf:case>
    <xf:trigger>
        <xf:label>Enregistrer</xf:label>
        <xf:action ev:event="DOMActivate">
            <!-- @maintenanceStatus -->
            <xf:setvalue if="eac:control/@maintenanceStatus = 'new'" ref="eac:control/@maintenanceStatus" value="'revised'"/>
            <xf:setvalue if="eac:control/@maintenanceStatus = ''" ref="eac:control/@maintenanceStatus" value="'new'"/>

            <!-- agent -->
            <xf:setvalue ref="eac:control/eac:maintenanceHistory/eac:maintenanceEvent[1]/eac:agent" value="instance('getAgent')/agent"/>

            <!-- @agentType -->
            <xf:setvalue ref="eac:control/eac:maintenanceHistory/eac:maintenanceEvent[1]/eac:agent/@agentType" value="'human'"/>

            <!-- @maintenanceEventType -->
            <xf:setvalue if="count(eac:control/eac:maintenanceHistory/eac:maintenanceEvent) > 1" ref="eac:control/eac:maintenanceHistory/eac:maintenanceEvent[1]/@maintenanceEventType" value="'revised'"/>
            <xf:setvalue if="count(eac:control/eac:maintenanceHistory/eac:maintenanceEvent) = 1" ref="eac:control/eac:maintenanceHistory/eac:maintenanceEvent[1]/@maintenanceEventType" value="'created'"/>

            <!-- eventDateTime -->
            <xf:setvalue ref="eac:control/eac:maintenanceHistory/eac:maintenanceEvent[1]/eac:eventDateTime/@standardDateTime" value="now()"/>
        </xf:action>
        <xf:show dialog="control" ev:event="DOMActivate"/>
    </xf:trigger>
    <xf:dialog id="control">
        <xf:group ref="eac:control/eac:maintenanceHistory/eac:maintenanceEvent[1]">
            <xf:input ref="eac:eventDescription">
                <xf:label>Motif de la révision</xf:label>
            </xf:input>
        </xf:group>
        <xf:trigger>
            <xf:label>Annuler</xf:label>
            <xf:hide ev:event="DOMActivate" dialog="control"/>
        </xf:trigger>
        <xf:submit submission="save2db">
            <xf:label>Valider</xf:label>
        </xf:submit>
    </xf:dialog>
    <!--<xf:repeat id="srch" nodeset="instance('isearch')/search">
        <xf:input ref="." incremental="true" delay="500">
            <xf:label>Subject : </xf:label>
            <xf:send submission="getWord" ev:event="xforms-value-changed"/>
            <xf:action ev:event="xforms-value-changed">
                <xf:insert context="instance('it')/test" nodeset="." at="index('srch')" origin="instance('iresults')/*"/>
            </xf:action>
            <xf:toggle ev:event="DOMFocusIn" case="show-autocompletion" />
        </xf:input>
        <xf:switch>
            <xf:case id="show-autocompletion">
                <xf:repeat id="results" nodeset="instance('it')/*[index('srch')]/*">
                    <xf:trigger appearance="minimal">
                        <xf:label><xf:output value="."/></xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:setvalue ref="instance('isearch')/search[index('srch')]" value="instance('iresults')/*[index('results')]/@xml:id" />
                            <xf:toggle case="hide-autocompletion" />
                        </xf:action>
                    </xf:trigger>
                </xf:repeat>
            </xf:case>
            <xf:case id="hide-autocompletion" />
        </xf:switch>
    </xf:repeat>-->
    <!--<xf:submit submission="save2file">
        <xf:label>Save 2 file (with validation)</xf:label>
    </xf:submit>-->
</form>